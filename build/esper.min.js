!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.esper=t()}}(function(){var t;return function e(t,i,n){function r(s,o){if(!i[s]){if(!t[s]){var h="function"==typeof require&&require;if(!o&&h)return h(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=i[s]={exports:{}};t[s][0].call(d.exports,function(e){var i=t[s][1][e];return r(i?i:e)},d,d.exports,e,t,i,n)}return i[s].exports}for(var a="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e,i){!function(){"use strict";function i(t){if(!t)return i.identity();if(t.data instanceof Array)9===t.data.length?this.data=t.data.slice(0):this.data=[t.data[0],t.data[1],t.data[2],t.data[4],t.data[5],t.data[6],t.data[8],t.data[9],t.data[10]];else{if(9!==t.length)return i.identity();this.data=Array.prototype.slice.call(t)}}var n=t("./Vec3");t("./Vec4");i.prototype.row=function(t){return new n(this.data[0+t],this.data[3+t],this.data[6+t])},i.prototype.col=function(t){return new n(this.data[0+3*t],this.data[1+3*t],this.data[2+3*t])},i.identity=function(){return new i([1,0,0,0,1,0,0,0,1])},i.scale=function(t){return new i("number"==typeof t?[t,0,0,0,t,0,0,0,t]:t instanceof Array?[t[0],0,0,0,t[1],0,0,0,t[2]]:[t.x,0,0,0,t.y,0,0,0,t.z])},i.rotationDegrees=function(t,e){return this.rotationRadians(t*Math.PI/180,e)},i.rotationRadians=function(t,e){if(e instanceof Array&&(e=new n(e)),0===e.lengthSquared())return this.identity();var r=e.normalize(),a=r.x,s=r.y,o=r.z,h=t>0?t%(2*Math.PI):t%(-2*Math.PI),u=Math.sin(h),d=Math.cos(h),f=a*a,c=s*s,l=o*o,p=a*s,m=s*o,y=o*a,g=a*u,v=s*u,x=o*u,w=1-d;return new i([w*f+d,w*p+x,w*y-v,w*p-x,w*c+d,w*m+g,w*y+v,w*m-g,w*l+d])},i.rotationFromTo=function(t,e){var r,a,s,o,h,u,d,f,c,l,p,m=1e-6,y=new n(t).normalize(),g=new n(e).normalize(),v=y.dot(g),x=Math.abs(v),w=new i;return x>1-m?(o=Math.abs(y.x),h=Math.abs(y.y),u=Math.abs(y.z),r=h>o?u>o?new n(1,0,0):new n(0,0,1):u>h?new n(0,1,0):new n(0,0,1),a=r.sub(y),s=r.sub(g),c=2/a.dot(a),l=2/s.dot(s),p=c*l*a.dot(s),w.data[0]=-c*a.x*a.x-l*s.x*s.x+p*s.x*a.x,w.data[3]=-c*a.x*a.y-l*s.x*s.y+p*s.x*a.y,w.data[6]=-c*a.x*a.z-l*s.x*s.z+p*s.x*a.z,w.data[1]=-c*a.y*a.x-l*s.y*s.x+p*s.y*a.x,w.data[4]=-c*a.y*a.y-l*s.y*s.y+p*s.y*a.y,w.data[7]=-c*a.y*a.z-l*s.y*s.z+p*s.y*a.z,w.data[2]=-c*a.z*a.x-l*s.z*s.x+p*s.z*a.x,w.data[5]=-c*a.z*a.y-l*s.z*s.y+p*s.z*a.y,w.data[8]=-c*a.z*a.z-l*s.z*s.z+p*s.z*a.z,w.data[0]+=1,w.data[4]+=1,w.data[8]+=1):(s=y.cross(g),a=1/(1+v),d=a*s.x,f=a*s.z,c=d*s.y,l=d*s.z,p=f*s.y,w.data[0]=v+d*s.x,w.data[3]=c-s.z,w.data[6]=l+s.y,w.data[1]=c+s.z,w.data[4]=v+a*s.y*s.y,w.data[7]=p-s.x,w.data[2]=l-s.y,w.data[5]=p+s.x,w.data[8]=v+f*s.z),w},i.prototype.add=function(t){var e,n=new i(t);for(e=0;9>e;e++)n.data[e]+=this.data[e];return n},i.prototype.sub=function(t){var e,n=new i(t);for(e=0;9>e;e++)n.data[e]=this.data[e]-n.data[e];return n},i.prototype.multVector=function(t){return t=t instanceof Array?new n(t):t,new n({x:this.data[0]*t.x+this.data[3]*t.y+this.data[6]*t.z,y:this.data[1]*t.x+this.data[4]*t.y+this.data[7]*t.z,z:this.data[2]*t.x+this.data[5]*t.y+this.data[8]*t.z})},i.prototype.multScalar=function(t){var e,n=new i;for(e=0;9>e;e++)n.data[e]=this.data[e]*t;return n},i.prototype.multMatrix=function(t){var e,n=new i;for((t.data&&16===t.data.length||t instanceof Array)&&(t=new i(t)),e=0;3>e;e++)n.data[e]=this.data[e]*t.data[0]+this.data[e+3]*t.data[1]+this.data[e+6]*t.data[2],n.data[e+3]=this.data[e]*t.data[3]+this.data[e+3]*t.data[4]+this.data[e+6]*t.data[5],n.data[e+6]=this.data[e]*t.data[6]+this.data[e+3]*t.data[7]+this.data[e+6]*t.data[8];return n},i.prototype.mult=function(t){return"number"==typeof t?this.multScalar(t):t instanceof Array?3===t.length||4===t.length?this.multVector(t):this.multMatrix(t):void 0!==t.x&&void 0!==t.y&&void 0!==t.z?this.multVector(t):this.multMatrix(t)},i.prototype.div=function(t){var e,n=new i;for(e=0;9>e;e++)n.data[e]=this.data[e]/t;return n},i.prototype.equals=function(t,e){var i;for(e=void 0===e?0:e,i=0;9>i;i++)if(!(this.data[i]===t.data[i]||Math.abs(this.data[i]-t.data[i])<=e))return!1;return!0},i.prototype.transpose=function(){var t,e=new i;for(t=0;3>t;t++)e.data[3*t]=this.data[t],e.data[3*t+1]=this.data[t+3],e.data[3*t+2]=this.data[t+6];return e},i.prototype.inverse=function(){var t,e=new i;return e.data[0]=this.data[4]*this.data[8]-this.data[7]*this.data[5],e.data[3]=-this.data[3]*this.data[8]+this.data[6]*this.data[5],e.data[6]=this.data[3]*this.data[7]-this.data[6]*this.data[4],e.data[1]=-this.data[1]*this.data[8]+this.data[7]*this.data[2],e.data[4]=this.data[0]*this.data[8]-this.data[6]*this.data[2],e.data[7]=-this.data[0]*this.data[7]+this.data[6]*this.data[1],e.data[2]=this.data[1]*this.data[5]-this.data[4]*this.data[2],e.data[5]=-this.data[0]*this.data[5]+this.data[3]*this.data[2],e.data[8]=this.data[0]*this.data[4]-this.data[3]*this.data[1],t=this.data[0]*e.data[0]+this.data[1]*e.data[3]+this.data[2]*e.data[6],e.mult(1/t)},i.prototype.decompose=function(){var t=this.col(0),e=this.col(1),i=this.col(2);return{left:t.normalize(),up:e.normalize(),forward:i.normalize(),scale:new n(t.length(),e.length(),i.length())}},i.random=function(){var t=i.rotationRadians(360*Math.random(),n.random()),e=i.scale(10*Math.random());return t.mult(e)},i.prototype.toString=function(){return this.data[0]+", "+this.data[3]+", "+this.data[6]+",\n"+this.data[1]+", "+this.data[4]+", "+this.data[7]+",\n"+this.data[2]+", "+this.data[5]+", "+this.data[8]},i.prototype.toArray=function(){return this.data.slice(0)},e.exports=i}()},{"./Vec3":7,"./Vec4":8}],2:[function(t,e,i){!function(){"use strict";function i(t){if(!t)return i.identity();if(t.data instanceof Array)16===t.data.length?this.data=t.data.slice(0):this.data=[t.data[0],t.data[1],t.data[2],0,t.data[3],t.data[4],t.data[5],0,t.data[6],t.data[7],t.data[8],0,0,0,0,1];else{if(16!==t.length)return i.identity();this.data=Array.prototype.slice.call(t)}}var n=t("./Vec3"),r=t("./Vec4"),a=t("./Mat33");i.prototype.row=function(t){return new r(this.data[0+t],this.data[4+t],this.data[8+t],this.data[12+t])},i.prototype.col=function(t){return new r(this.data[0+4*t],this.data[1+4*t],this.data[2+4*t],this.data[3+4*t])},i.identity=function(){return new i([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},i.scale=function(t){return new i("number"==typeof t?[t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1]:t instanceof Array?[t[0],0,0,0,0,t[1],0,0,0,0,t[2],0,0,0,0,1]:[t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1])},i.translation=function(t){return new i(t instanceof Array?[1,0,0,0,0,1,0,0,0,0,1,0,t[0],t[1],t[2],1]:[1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1])},i.rotationDegrees=function(t,e){return new i(a.rotationDegrees(t,e))},i.rotationRadians=function(t,e){return new i(a.rotationRadians(t,e))},i.rotationFromTo=function(t,e){return new i(a.rotationFromTo(t,e))},i.prototype.add=function(t){var e,n=new i(t);for(e=0;16>e;e++)n.data[e]+=this.data[e];return n},i.prototype.sub=function(t){var e,n=new i(t);for(e=0;16>e;e++)n.data[e]=this.data[e]-n.data[e];return n},i.prototype.multVector3=function(t){return t=t instanceof Array?new n(t):t,new n({x:this.data[0]*t.x+this.data[4]*t.y+this.data[8]*t.z+this.data[12],y:this.data[1]*t.x+this.data[5]*t.y+this.data[9]*t.z+this.data[13],z:this.data[2]*t.x+this.data[6]*t.y+this.data[10]*t.z+this.data[14]})},i.prototype.multVector4=function(t){return t=t instanceof Array?new r(t):t,new r({x:this.data[0]*t.x+this.data[4]*t.y+this.data[8]*t.z+this.data[12]*t.w,y:this.data[1]*t.x+this.data[5]*t.y+this.data[9]*t.z+this.data[13]*t.w,z:this.data[2]*t.x+this.data[6]*t.y+this.data[10]*t.z+this.data[14]*t.w,w:this.data[3]*t.x+this.data[7]*t.y+this.data[11]*t.z+this.data[15]*t.w})},i.prototype.multScalar=function(t){var e,n=new i;for(e=0;16>e;e++)n.data[e]=this.data[e]*t;return n},i.prototype.multMatrix=function(t){var e,n=new i;for((t.data&&9===t.data.length||t instanceof Array)&&(t=new i(t)),e=0;4>e;e++)n.data[e]=this.data[e]*t.data[0]+this.data[e+4]*t.data[1]+this.data[e+8]*t.data[2]+this.data[e+12]*t.data[3],n.data[e+4]=this.data[e]*t.data[4]+this.data[e+4]*t.data[5]+this.data[e+8]*t.data[6]+this.data[e+12]*t.data[7],n.data[e+8]=this.data[e]*t.data[8]+this.data[e+4]*t.data[9]+this.data[e+8]*t.data[10]+this.data[e+12]*t.data[11],n.data[e+12]=this.data[e]*t.data[12]+this.data[e+4]*t.data[13]+this.data[e+8]*t.data[14]+this.data[e+12]*t.data[15];return n},i.prototype.mult=function(t){return"number"==typeof t?this.multScalar(t):t instanceof Array?3===t.length?this.multVector3(t):4===t.length?this.multVector4(t):this.multMatrix(t):void 0!==t.x&&void 0!==t.y&&void 0!==t.z?void 0!==t.w?this.multVector4(t):this.multVector3(t):this.multMatrix(t)},i.prototype.div=function(t){var e,n=new i;for(e=0;16>e;e++)n.data[e]=this.data[e]/t;return n},i.prototype.equals=function(t,e){var i;for(e=void 0===e?0:e,i=0;16>i;i++)if(!(this.data[i]===t.data[i]||Math.abs(this.data[i]-t.data[i])<=e))return!1;return!0},i.ortho=function(t,e,n,r,a,s){var o=i.identity();return o.data[0]=2/(e-t),o.data[5]=2/(r-n),o.data[10]=-2/(s-a),o.data[12]=-((e+t)/(e-t)),o.data[13]=-((r+n)/(r-n)),o.data[14]=-((s+a)/(s-a)),o},i.perspective=function(t,e,n,r){var a=n*Math.tan(t*(Math.PI/360)),s=-a,o=s*e,h=-o,u=i.identity();return u.data[0]=2*n/(h-o),u.data[5]=2*n/(a-s),u.data[8]=(h+o)/(h-o),u.data[9]=(a+s)/(a-s),u.data[10]=-((r+n)/(r-n)),u.data[11]=-1,u.data[14]=-(2*(r*n)/(r-n)),u.data[15]=0,u},i.prototype.transpose=function(){var t,e=new i;for(t=0;4>t;t++)e.data[4*t]=this.data[t],e.data[4*t+1]=this.data[t+4],e.data[4*t+2]=this.data[t+8],e.data[4*t+3]=this.data[t+12];return e},i.prototype.inverse=function(){var t,e=new i;return e.data[0]=this.data[5]*this.data[10]*this.data[15]-this.data[5]*this.data[11]*this.data[14]-this.data[9]*this.data[6]*this.data[15]+this.data[9]*this.data[7]*this.data[14]+this.data[13]*this.data[6]*this.data[11]-this.data[13]*this.data[7]*this.data[10],e.data[4]=-this.data[4]*this.data[10]*this.data[15]+this.data[4]*this.data[11]*this.data[14]+this.data[8]*this.data[6]*this.data[15]-this.data[8]*this.data[7]*this.data[14]-this.data[12]*this.data[6]*this.data[11]+this.data[12]*this.data[7]*this.data[10],e.data[8]=this.data[4]*this.data[9]*this.data[15]-this.data[4]*this.data[11]*this.data[13]-this.data[8]*this.data[5]*this.data[15]+this.data[8]*this.data[7]*this.data[13]+this.data[12]*this.data[5]*this.data[11]-this.data[12]*this.data[7]*this.data[9],e.data[12]=-this.data[4]*this.data[9]*this.data[14]+this.data[4]*this.data[10]*this.data[13]+this.data[8]*this.data[5]*this.data[14]-this.data[8]*this.data[6]*this.data[13]-this.data[12]*this.data[5]*this.data[10]+this.data[12]*this.data[6]*this.data[9],e.data[1]=-this.data[1]*this.data[10]*this.data[15]+this.data[1]*this.data[11]*this.data[14]+this.data[9]*this.data[2]*this.data[15]-this.data[9]*this.data[3]*this.data[14]-this.data[13]*this.data[2]*this.data[11]+this.data[13]*this.data[3]*this.data[10],e.data[5]=this.data[0]*this.data[10]*this.data[15]-this.data[0]*this.data[11]*this.data[14]-this.data[8]*this.data[2]*this.data[15]+this.data[8]*this.data[3]*this.data[14]+this.data[12]*this.data[2]*this.data[11]-this.data[12]*this.data[3]*this.data[10],e.data[9]=-this.data[0]*this.data[9]*this.data[15]+this.data[0]*this.data[11]*this.data[13]+this.data[8]*this.data[1]*this.data[15]-this.data[8]*this.data[3]*this.data[13]-this.data[12]*this.data[1]*this.data[11]+this.data[12]*this.data[3]*this.data[9],e.data[13]=this.data[0]*this.data[9]*this.data[14]-this.data[0]*this.data[10]*this.data[13]-this.data[8]*this.data[1]*this.data[14]+this.data[8]*this.data[2]*this.data[13]+this.data[12]*this.data[1]*this.data[10]-this.data[12]*this.data[2]*this.data[9],e.data[2]=this.data[1]*this.data[6]*this.data[15]-this.data[1]*this.data[7]*this.data[14]-this.data[5]*this.data[2]*this.data[15]+this.data[5]*this.data[3]*this.data[14]+this.data[13]*this.data[2]*this.data[7]-this.data[13]*this.data[3]*this.data[6],e.data[6]=-this.data[0]*this.data[6]*this.data[15]+this.data[0]*this.data[7]*this.data[14]+this.data[4]*this.data[2]*this.data[15]-this.data[4]*this.data[3]*this.data[14]-this.data[12]*this.data[2]*this.data[7]+this.data[12]*this.data[3]*this.data[6],e.data[10]=this.data[0]*this.data[5]*this.data[15]-this.data[0]*this.data[7]*this.data[13]-this.data[4]*this.data[1]*this.data[15]+this.data[4]*this.data[3]*this.data[13]+this.data[12]*this.data[1]*this.data[7]-this.data[12]*this.data[3]*this.data[5],e.data[14]=-this.data[0]*this.data[5]*this.data[14]+this.data[0]*this.data[6]*this.data[13]+this.data[4]*this.data[1]*this.data[14]-this.data[4]*this.data[2]*this.data[13]-this.data[12]*this.data[1]*this.data[6]+this.data[12]*this.data[2]*this.data[5],e.data[3]=-this.data[1]*this.data[6]*this.data[11]+this.data[1]*this.data[7]*this.data[10]+this.data[5]*this.data[2]*this.data[11]-this.data[5]*this.data[3]*this.data[10]-this.data[9]*this.data[2]*this.data[7]+this.data[9]*this.data[3]*this.data[6],e.data[7]=this.data[0]*this.data[6]*this.data[11]-this.data[0]*this.data[7]*this.data[10]-this.data[4]*this.data[2]*this.data[11]+this.data[4]*this.data[3]*this.data[10]+this.data[8]*this.data[2]*this.data[7]-this.data[8]*this.data[3]*this.data[6],e.data[11]=-this.data[0]*this.data[5]*this.data[11]+this.data[0]*this.data[7]*this.data[9]+this.data[4]*this.data[1]*this.data[11]-this.data[4]*this.data[3]*this.data[9]-this.data[8]*this.data[1]*this.data[7]+this.data[8]*this.data[3]*this.data[5],e.data[15]=this.data[0]*this.data[5]*this.data[10]-this.data[0]*this.data[6]*this.data[9]-this.data[4]*this.data[1]*this.data[10]+this.data[4]*this.data[2]*this.data[9]+this.data[8]*this.data[1]*this.data[6]-this.data[8]*this.data[2]*this.data[5],t=this.data[0]*e.data[0]+this.data[1]*e.data[4]+this.data[2]*e.data[8]+this.data[3]*e.data[12],e.mult(1/t)},i.prototype.decompose=function(){var t=new n(this.col(0)),e=new n(this.col(1)),i=new n(this.col(2)),r=new n(this.col(3));return{left:t.normalize(),up:e.normalize(),forward:i.normalize(),origin:r,scale:new n(t.length(),e.length(),i.length())}},i.random=function(){var t=i.rotationRadians(360*Math.random(),n.random()),e=i.scale(10*Math.random()),r=i.translation(n.random());return r.mult(t.mult(e))},i.prototype.toString=function(){return this.data[0]+", "+this.data[4]+", "+this.data[8]+", "+this.data[12]+",\n"+this.data[1]+", "+this.data[5]+", "+this.data[9]+", "+this.data[13]+",\n"+this.data[2]+", "+this.data[6]+", "+this.data[10]+", "+this.data[14]+",\n"+this.data[3]+", "+this.data[7]+", "+this.data[11]+", "+this.data[15]},i.prototype.toArray=function(){return this.data.slice(0)},e.exports=i}()},{"./Mat33":1,"./Vec3":7,"./Vec4":8}],3:[function(t,e,i){!function(){"use strict";function i(){switch(arguments.length){case 1:var t=arguments[0];void 0!==t.w?this.w=t.w:void 0!==t[0]?this.w=t[0]:this.w=1,this.x=t.x||t[1]||0,this.y=t.y||t[2]||0,this.z=t.z||t[3]||0;break;case 4:this.w=arguments[0],this.x=arguments[1],this.y=arguments[2],this.z=arguments[3];break;default:this.w=1,this.x=0,this.y=0,this.z=0}return this}var n=t("./Vec3"),r=t("./Mat33");i.identity=function(){return new i(1,0,0,0)},i.prototype.negate=function(){return new i(-this.w,-this.x,-this.y,-this.z)},i.prototype.mult=function(t){t=t instanceof Array?new i(t):t;var e=t.w*this.w-t.x*this.x-t.y*this.y-t.z*this.z,n=this.y*t.z-this.z*t.y+this.w*t.x+this.x*t.w,r=this.z*t.x-this.x*t.z+this.w*t.y+this.y*t.w,a=this.x*t.y-this.y*t.x+this.w*t.z+this.z*t.w;return new i(e,n,r,a)},i.prototype.rotate=function(t){t=t instanceof Array?new n(t):t;var e=new i(0,t.x,t.y,t.z),r=this.mult(e).mult(this.inverse());return new n(r.x,r.y,r.z)},i.prototype.matrix=function(){var t=this.x*this.x,e=this.y*this.y,i=this.z*this.z,n=this.x*this.y,a=this.x*this.z,s=this.x*this.w,o=this.y*this.z,h=this.y*this.w,u=this.z*this.w;return new r([1-2*e-2*i,2*n+2*u,2*a-2*h,2*n-2*u,1-2*t-2*i,2*o+2*s,2*a+2*h,2*o-2*s,1-2*t-2*e])},i.rotationDegrees=function(t,e){return i.rotationRadians(t*(Math.PI/180),e)},i.rotationRadians=function(t,e){e instanceof Array&&(e=new n(e)),e=e.normalize();var r=t>0?t%(2*Math.PI):t%(-2*Math.PI),a=Math.sin(r/2),s=Math.cos(r/2);return new i(s,e.x*a,e.y*a,e.z*a).normalize()},i.slerp=function(t,e,n){t instanceof Array&&(t=new i(t)),e instanceof Array&&(e=new i(e));var r=t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z;if(Math.abs(r)>=1)return new i(t.w,t.x,t.y,t.z);0>r&&(t=t.negate(),r=-r);var a=Math.acos(r),s=Math.sqrt(1-r*r),o=Math.sin((1-n)*a)/s,h=Math.sin(n*a)/s;return new i(t.w*o+e.w*h,t.x*o+e.x*h,t.y*o+e.y*h,t.z*o+e.z*h)},i.prototype.equals=function(t,e){var i=void 0!==t.w?t.w:t[0],n=void 0!==t.x?t.x:t[1],r=void 0!==t.y?t.y:t[2],a=void 0!==t.z?t.z:t[3];return e=void 0===e?0:e,(this.w===i||Math.abs(this.w-i)<=e)&&(this.x===n||Math.abs(this.x-n)<=e)&&(this.y===r||Math.abs(this.y-r)<=e)&&(this.z===a||Math.abs(this.z-a)<=e)},i.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0!==t?new i(this.w/t,this.x/t,this.y/t,this.z/t):new i},i.prototype.conjugate=function(){return new i(this.w,-this.x,-this.y,-this.z)},i.prototype.inverse=function(){return this.conjugate()},i.random=function(){var t=n.random().normalize(),e=Math.random();return i.rotationRadians(e,t)},i.prototype.toString=function(){return this.x+", "+this.y+", "+this.z+", "+this.w},i.prototype.toArray=function(){return[this.w,this.x,this.y,this.z]},e.exports=i}()},{"./Mat33":1,"./Vec3":7}],4:[function(t,e,i){!function(){"use strict";function i(t){return t=t||{},t._up&&t._forward&&t._left&&t._origin&&t._scale?(this._up=t.up(),this._forward=t.forward(),this._left=t.left(),this._origin=t.origin(),this._scale=t.scale()):t.data&&t.data instanceof Array?(t=t.decompose(),this._up=t.up,this._forward=t.forward,this._left=t.left,this._scale=t.scale,this._origin=t.origin||new n(0,0,0)):(this._up=t.up?new n(t.up).normalize():new n(0,1,0),this._forward=t.forward?new n(t.forward).normalize():new n(0,0,1),this._left=t.left?new n(t.left).normalize():this._up.cross(this._forward).normalize(),this.origin(t.origin||new n(0,0,0)),this.scale(t.scale||new n(1,1,1))),this}var n=t("./Vec3"),r=t("./Mat33"),a=t("./Mat44");i.identity=function(){return new i({up:new n(0,1,0),forward:new n(0,0,1),left:new n(1,0,0),origin:new n(0,0,0),scale:new n(1,1,1)})},i.prototype.origin=function(t){return t?(this._origin=new n(t),this):new n(this._origin)},i.prototype.forward=function(t){if(t){t=t instanceof Array?new n(t).normalize():t.normalize();var e=r.rotationFromTo(this._forward,t);return this._forward=t,this._up=e.mult(this._up).normalize(),this._left=e.mult(this._left).normalize(),this}return new n(this._forward)},i.prototype.up=function(t){if(t){t=t instanceof Array?new n(t).normalize():t.normalize();var e=r.rotationFromTo(this._up,t);return this._forward=e.mult(this._forward).normalize(),this._up=t,this._left=e.mult(this._left).normalize(),this}return new n(this._up)},i.prototype.left=function(t){if(t){t=t instanceof Array?new n(t).normalize():t.normalize();var e=r.rotationFromTo(this._left,t);return this._forward=e.mult(this._forward).normalize(),this._up=e.mult(this._up).normalize(),this._left=t,this}return new n(this._left)},i.prototype.scale=function(t){return t?("number"==typeof t?this._scale=new n(t,t,t):this._scale=new n(t),this):this._scale},i.prototype.mult=function(t){return new i(t instanceof Array||t.data instanceof Array?this.matrix().mult(t):this.matrix().mult(t.matrix()))},i.prototype.scaleMatrix=function(){return a.scale(this._scale)},i.prototype.rotationMatrix=function(){return new a([this._left.x,this._left.y,this._left.z,0,this._up.x,this._up.y,this._up.z,0,this._forward.x,this._forward.y,this._forward.z,0,0,0,0,1])},i.prototype.translationMatrix=function(){return a.translation(this._origin)},i.prototype.matrix=function(){return this.translationMatrix().mult(this.rotationMatrix()).mult(this.scaleMatrix())},i.prototype.inverseScaleMatrix=function(){return a.scale(new n(1/this._scale.x,1/this._scale.y,1/this._scale.z))},i.prototype.inverseRotationMatrix=function(){return new a([this._left.x,this._up.x,this._forward.x,0,this._left.y,this._up.y,this._forward.y,0,this._left.z,this._up.z,this._forward.z,0,0,0,0,1])},i.prototype.inverseTranslationMatrix=function(){return a.translation(this._origin.negate())},i.prototype.inverseMatrix=function(){return this.inverseScaleMatrix().mult(this.inverseRotationMatrix()).mult(this.inverseTranslationMatrix())},i.prototype.viewMatrix=function(){var t=this._origin.negate(),e=this._left.negate(),i=this._forward.negate();return new a([e.x,this._up.x,i.x,0,e.y,this._up.y,i.y,0,e.z,this._up.z,i.z,0,t.dot(e),t.dot(this._up),t.dot(i),1])},i.prototype.translateWorld=function(t){return this._origin=this._origin.add(t),this},i.prototype.translateLocal=function(t){return t instanceof Array&&(t=new n(t)),this._origin=this._origin.add(this._left.mult(t.x)).add(this._up.mult(t.y)).add(this._forward.mult(t.z)),this},i.prototype.rotateWorldDegrees=function(t,e){return this.rotateWorldRadians(t*Math.PI/180,e)},i.prototype.rotateWorldRadians=function(t,e){var i=r.rotationRadians(t,e);return this._up=i.mult(this._up),this._forward=i.mult(this._forward),this._left=i.mult(this._left),this},i.prototype.rotateLocalDegrees=function(t,e){return this.rotateWorldDegrees(t,this.rotationMatrix().mult(e))},i.prototype.rotateLocalRadians=function(t,e){return this.rotateWorldRadians(t,this.rotationMatrix().mult(e))},i.prototype.localToWorld=function(t,e,i,n){var r=new a;return e||(r=this.scaleMatrix().mult(r)),i||(r=this.rotationMatrix().mult(r)),n||(r=this.translationMatrix().mult(r)),r.mult(t)},i.prototype.worldToLocal=function(t,e,i,n){var r=new a;return n||(r=this.inverseTranslationMatrix().mult(r)),i||(r=this.inverseRotationMatrix().mult(r)),e||(r=this.inverseScaleMatrix().mult(r)),r.mult(t)},i.prototype.equals=function(t,e){return this._origin.equals(t.origin(),e)&&this._forward.equals(t.forward(),e)&&this._up.equals(t.up(),e)&&this._left.equals(t.left(),e)&&this._scale.equals(t.scale(),e)},i.random=function(){return(new i).origin(n.random()).forward(n.random()).scale(n.random())},i.prototype.toString=function(){return this.matrix().toString()},e.exports=i}()},{"./Mat33":1,"./Mat44":2,"./Vec3":7}],5:[function(t,e,i){!function(){"use strict";function i(){switch(arguments.length){case 1:var t=arguments[0];this.a=new n(t[0]||t.a),this.b=new n(t[1]||t.b),this.c=new n(t[2]||t.c);break;case 3:this.a=new n(arguments[0]),this.b=new n(arguments[1]),this.c=new n(arguments[2]);break;default:this.a=new n(0,0,0),this.b=new n(1,0,0),this.c=new n(1,1,0)}}var n=t("./Vec3");i.prototype.radius=function(){var t=this.centroid(),e=this.a.sub(t).length(),i=this.b.sub(t).length(),n=this.c.sub(t).length();return Math.max(e,Math.max(i,n))},i.prototype.centroid=function(){return this.a.add(this.b).add(this.c).div(3)},i.prototype.normal=function(){var t=this.b.sub(this.a),e=this.c.sub(this.a);return t.cross(e).normalize()},i.prototype.area=function(){var t=this.b.sub(this.a),e=this.c.sub(this.a);return t.cross(e).length()},i.prototype.edge=function(t){switch(t.toLowerCase()){case"ab":return this.b.sub(this.a);case"ac":return this.c.sub(this.a);case"ba":return this.a.sub(this.b);case"bc":return this.c.sub(this.b);case"ca":return this.a.sub(this.c);case"cb":return this.b.sub(this.c)}return console.warn("Unrecognized edge id '"+t+"', returning 'null'."),null},i.prototype.isInside=function(t){var e=new n(t),i=this.a,r=this.b,a=this.c,s=this.normal(),o=1/r.sub(i).cross(a.sub(i)).dot(s),h=a.sub(r).cross(e.sub(r)).dot(s).mult(o),u=i.sub(a).cross(e.sub(a)).dot(s).mult(o);return 0>h||0>u||h+u>1?!1:!0},i.prototype.intersect=function(t,e,i,r){var a=new n(t),s=new n(e),o=this.normal(),h=new n(s).dot(o);if(0===h||r&&h>0)return!1;var u=this.a.sub(a).dot(o)/h;if(i&&0>u)return!1;var d=a.add(s.mult(u));return this.isInside(d)?{intersection:d,normal:o,t:u}:!1},i.prototype.closestPointOnEdge=function(t,e){var i=this[t[0]],r=this.edge(t),a=new n(e).sub(i).dot(r)/r.dot(r);return 0>a&&(a=0),a>1&&(a=1),i.plus(r.mult(a))},i.prototype.closestPoint=function(t){var e=this.closestPointOnEdge("ab",t),i=this.closestPointOnEdge("bc",t),n=this.closestPointOnEdge("ca",t),r=(e-t).lengthSquared(),a=(i-t).lengthSquared(),s=(n-t).lengthSquared();return a>r?s>r?e:n:s>a?i:n},i.random=function(){var t=n.random(),e=n.random(),r=n.random(),a=t.add(e).add(r).div(3),s=t.sub(a),o=e.sub(a),h=r.sub(a),u=s.length(),d=o.length(),f=h.length(),c=Math.max(Math.max(u,d),f),l=1/c;return new i(s.mult(l),o.mult(l),h.mult(l))},i.prototype.equals=function(t,e){return e=void 0===e?0:e,this.a.equals(t.a,e)&&this.b.equals(t.b,e)&&this.c.equals(t.c,e)},i.prototype.toString=function(){return this.a.toString()+", "+this.b.toString()+", "+this.c.toString()},e.exports=i}()},{"./Vec3":7}],6:[function(t,e,i){!function(){"use strict";function t(){switch(arguments.length){case 1:var t=arguments[0];this.x=t.x||t[0]||0,this.y=t.y||t[1]||0;break;case 2:this.x=arguments[0],this.y=arguments[1];break;default:this.x=0,this.y=0}return this}t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.add=function(e){return e instanceof Array?new t(this.x+e[0],this.y+e[1]):new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return e instanceof Array?new t(this.x-e[0],this.y-e[1]):new t(this.x-e.x,this.y-e.y)},t.prototype.mult=function(e){return new t(this.x*e,this.y*e)},t.prototype.div=function(e){return new t(this.x/e,this.y/e)},t.prototype.dot=function(t){return t instanceof Array?this.x*t[0]+this.y*t[1]:this.x*t.x+this.y*t.y},t.prototype.cross=function(t){return t instanceof Array?this.x*t[1]-this.y*t[0]:this.x*t.y-this.y*t.x},t.prototype.length=function(t){return void 0===t?Math.sqrt(this.dot(this)):this.normalize().mult(t)},t.prototype.lengthSquared=function(){return this.dot(this)},t.prototype.equals=function(t,e){var i=void 0!==t.x?t.x:t[0],n=void 0!==t.y?t.y:t[1];return e=void 0===e?0:e,(this.x===i||Math.abs(this.x-i)<=e)&&(this.y===n||Math.abs(this.y-n)<=e)},t.prototype.normalize=function(){var e=this.length();return 0!==e?new t(this.x/e,this.y/e):new t},t.prototype.unsignedAngleRadians=function(t){var e=void 0!==t.x?t.x:t[0],i=void 0!==t.y?t.y:t[1],n=Math.atan2(i,e)-Math.atan2(this.y,this.x);return 0>n&&(n+=2*Math.PI),n},t.prototype.unsignedAngleDegrees=function(t){return this.unsignedAngleRadians(t)*(180/Math.PI)},t.random=function(){return new t(Math.random(),Math.random()).normalize()},t.prototype.toString=function(){return this.x+", "+this.y},t.prototype.toArray=function(){return[this.x,this.y]},e.exports=t}()},{}],7:[function(t,e,i){!function(){"use strict";function t(){switch(arguments.length){case 1:var t=arguments[0];this.x=t.x||t[0]||0,this.y=t.y||t[1]||0,this.z=t.z||t[2]||0;break;case 3:this.x=arguments[0],this.y=arguments[1],this.z=arguments[2];break;default:this.x=0,this.y=0,this.z=0}return this}t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.add=function(e){return e instanceof Array?new t(this.x+e[0],this.y+e[1],this.z+e[2]):new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.sub=function(e){return e instanceof Array?new t(this.x-e[0],this.y-e[1],this.z-e[2]):new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.mult=function(e){return new t(this.x*e,this.y*e,this.z*e)},t.prototype.div=function(e){return new t(this.x/e,this.y/e,this.z/e)},t.prototype.dot=function(t){return t instanceof Array?this.x*t[0]+this.y*t[1]+this.z*t[2]:this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.cross=function(e){return e instanceof Array?new t(this.y*e[2]-e[1]*this.z,-this.x*e[2]+e[0]*this.z,this.x*e[1]-e[0]*this.y):new t(this.y*e.z-e.y*this.z,-this.x*e.z+e.x*this.z,this.x*e.y-e.x*this.y)},t.prototype.length=function(t){return void 0===t?Math.sqrt(this.dot(this)):this.normalize().mult(t)},t.prototype.lengthSquared=function(){return this.dot(this)},t.prototype.equals=function(t,e){var i=void 0!==t.x?t.x:t[0],n=void 0!==t.y?t.y:t[1],r=void 0!==t.z?t.z:t[2];return e=void 0===e?0:e,(this.x===i||Math.abs(this.x-i)<=e)&&(this.y===n||Math.abs(this.y-n)<=e)&&(this.z===r||Math.abs(this.z-r)<=e)},t.prototype.normalize=function(){var e=this.length();return 0!==e?new t(this.x/e,this.y/e,this.z/e):new t},t.prototype.unsignedAngleRadians=function(e,i){var n=this.normalize(),r=new t(e).normalize(),a=n.dot(r),s=Math.max(-1,Math.min(1,a)),o=Math.acos(s),h=n.cross(r),u=new t(i||h);return u.dot(h)<0&&(o=o>=.5*Math.PI?Math.PI+Math.PI-o:2*Math.PI-o),o},t.prototype.unsignedAngleDegrees=function(t,e){return this.unsignedAngleRadians(t,e)*(180/Math.PI)},t.random=function(){return new t(Math.random(),Math.random(),Math.random()).normalize()},t.prototype.toString=function(){return this.x+", "+this.y+", "+this.z},t.prototype.toArray=function(){return[this.x,this.y,this.z]},e.exports=t}()},{}],8:[function(t,e,i){!function(){"use strict";function t(){switch(arguments.length){case 1:var t=arguments[0];this.x=t.x||t[0]||0,this.y=t.y||t[1]||0,this.z=t.z||t[2]||0,this.w=t.w||t[3]||0;break;case 4:this.x=arguments[0],this.y=arguments[1],this.z=arguments[2],this.w=arguments[3];break;default:this.x=0,this.y=0,this.z=0,this.w=0}return this}t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z,-this.w)},t.prototype.add=function(e){return e instanceof Array?new t(this.x+e[0],this.y+e[1],this.z+e[2],this.w+e[3]):new t(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},t.prototype.sub=function(e){return e instanceof Array?new t(this.x-e[0],this.y-e[1],this.z-e[2],this.w-e[3]):new t(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},t.prototype.mult=function(e){return new t(this.x*e,this.y*e,this.z*e,this.w*e)},t.prototype.div=function(e){return new t(this.x/e,this.y/e,this.z/e,this.w/e)},t.prototype.dot=function(t){return t instanceof Array?this.x*t[0]+this.y*t[1]+this.z*t[2]+this.w*t[3]:this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},t.prototype.length=function(t){return void 0===t?Math.sqrt(this.dot(this)):this.normalize().mult(t)},t.prototype.lengthSquared=function(){return this.dot(this)},t.prototype.equals=function(t,e){var i=void 0!==t.x?t.x:t[0],n=void 0!==t.y?t.y:t[1],r=void 0!==t.z?t.z:t[2],a=void 0!==t.w?t.w:t[3];return e=void 0===e?0:e,(this.x===i||Math.abs(this.x-i)<=e)&&(this.y===n||Math.abs(this.y-n)<=e)&&(this.z===r||Math.abs(this.z-r)<=e)&&(this.w===a||Math.abs(this.w-a)<=e)},t.prototype.normalize=function(){var e=this.length();return 0!==e?new t(this.x/e,this.y/e,this.z/e,this.w/e):new t},t.random=function(){return new t(Math.random(),Math.random(),Math.random(),Math.random()).normalize()},t.prototype.toString=function(){return this.x+", "+this.y+", "+this.z+", "+this.w},t.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},e.exports=t}()},{}],9:[function(t,e,i){!function(){"use strict";e.exports={Mat33:t("./Mat33"),Mat44:t("./Mat44"),Vec2:t("./Vec2"),Vec3:t("./Vec3"),Vec4:t("./Vec3"),Quaternion:t("./Quaternion"),Transform:t("./Transform"),Triangle:t("./Triangle")}}()},{"./Mat33":1,"./Mat44":2,"./Quaternion":3,"./Transform":4,"./Triangle":5,"./Vec2":6,"./Vec3":7}],10:[function(t,e,i){(function(t){function e(t,e){for(var i=0,n=t.length-1;n>=0;n--){var r=t[n];"."===r?t.splice(n,1):".."===r?(t.splice(n,1),i++):i&&(t.splice(n,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var i=[],n=0;n<t.length;n++)e(t[n],n,t)&&i.push(t[n]);return i}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,a=function(t){return r.exec(t).slice(1)};i.resolve=function(){for(var i="",r=!1,a=arguments.length-1;a>=-1&&!r;a--){var s=a>=0?arguments[a]:t.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(i=s+"/"+i,r="/"===s.charAt(0))}return i=e(n(i.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+i||"."},i.normalize=function(t){var r=i.isAbsolute(t),a="/"===s(t,-1);return t=e(n(t.split("/"),function(t){return!!t}),!r).join("/"),t||r||(t="."),t&&a&&(t+="/"),(r?"/":"")+t;
},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(n(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},i.relative=function(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var r=n(t.split("/")),a=n(e.split("/")),s=Math.min(r.length,a.length),o=s,h=0;s>h;h++)if(r[h]!==a[h]){o=h;break}for(var u=[],h=o;h<r.length;h++)u.push("..");return u=u.concat(a.slice(o)),u.join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=a(t),i=e[0],n=e[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."},i.basename=function(t,e){var i=a(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return a(t)[3]};var s="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return 0>e&&(e=t.length+e),t.substr(e,i)}}).call(this,t("_process"))},{_process:11}],11:[function(t,e,i){function n(){d=!1,o.length?u=o.concat(u):f=-1,u.length&&r()}function r(){if(!d){var t=setTimeout(n);d=!0;for(var e=u.length;e;){for(o=u,u=[];++f<e;)o&&o[f].run();f=-1,e=u.length}o=null,d=!1,clearTimeout(t)}}function a(t,e){this.fun=t,this.array=e}function s(){}var o,h=e.exports={},u=[],d=!1,f=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new a(t,e)),1!==u.length||d||setTimeout(r,0)},a.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=s,h.addListener=s,h.once=s,h.off=s,h.removeListener=s,h.removeAllListeners=s,h.emit=s,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],12:[function(e,i,n){(function(){var e,i,r,a,s,o,h,u,d,f,c,l,p,m,y=[].slice;s="3.0.0",i="pending",a="resolved",r="rejected",d=function(t,e){return null!=t?t.hasOwnProperty(e):void 0},c=function(t){return d(t,"length")&&d(t,"callee")},l=function(t){return d(t,"promise")&&"function"==typeof(null!=t?t.promise:void 0)},u=function(t){return c(t)?u(Array.prototype.slice.call(t)):Array.isArray(t)?t.reduce(function(t,e){return Array.isArray(e)?t.concat(u(e)):(t.push(e),t)},[]):[t]},o=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},p=function(t,e){return function(){var i;return i=[t].concat(Array.prototype.slice.call(arguments,0)),e.apply(this,i)}},h=function(t,e,i){var n,r,a,s,o;for(s=u(t),o=[],r=0,a=s.length;a>r;r++)n=s[r],o.push(n.call.apply(n,[i].concat(y.call(e))));return o},e=function(){var t,n,s,o,d,f,c;return c=i,o=[],d=[],f=[],s={resolved:{},rejected:{},pending:{}},this.promise=function(t){var n,p;return t=t||{},t.state=function(){return c},p=function(e,n,r){return function(){return c===i&&n.push.apply(n,u(arguments)),e()&&h(arguments,s[r]),t}},t.done=p(function(){return c===a},o,a),t.fail=p(function(){return c===r},d,r),t.progress=p(function(){return c!==i},f,i),t.always=function(){var e;return(e=t.done.apply(t,arguments)).fail.apply(e,arguments)},n=function(i,n,r){var a,s;return s=new e,a=function(e,i,n){return n?t[e](function(){var t,e;return t=1<=arguments.length?y.call(arguments,0):[],e=n.apply(null,t),l(e)?e.done(s.resolve).fail(s.reject).progress(s.notify):s[i](e)}):t[e](s[i])},a("done","resolve",i),a("fail","reject",n),a("progress","notify",r),s},t.pipe=n,t.then=n,null==t.promise&&(t.promise=function(){return t}),t},this.promise(this),t=this,n=function(e,n,r){return function(){return c===i?(c=e,s[e]=arguments,h(n,s[e],r),t):this}},this.resolve=n(a,o),this.reject=n(r,d),this.notify=n(i,f),this.resolveWith=function(t,e){return n(a,o,t).apply(null,e)},this.rejectWith=function(t,e){return n(r,d,t).apply(null,e)},this.notifyWith=function(t,e){return n(i,f,t).apply(null,e)},this},m=function(){var t,i,n,r,a,s,h;if(i=u(arguments),1===i.length)return l(i[0])?i[0]:(new e).resolve(i[0]).promise();if(a=new e,!i.length)return a.resolve().promise();for(r=[],n=o(i.length,function(){return a.resolve.apply(a,r)}),i.forEach(function(t,e){return l(t)?t.done(function(){var t;return t=1<=arguments.length?y.call(arguments,0):[],r[e]=t.length>1?t:t[0],n()}):(r[e]=t,n())}),s=0,h=i.length;h>s;s++)t=i[s],l(t)&&t.fail(a.reject);return a.promise()},f=function(t){return t.Deferred=function(){return new e},t.ajax=p(t.ajax,function(t,i){var n,r,a,s;return null==i&&(i={}),r=new e,n=function(t,e){return p(t,function(){var t,i;return i=arguments[0],t=2<=arguments.length?y.call(arguments,1):[],i&&i.apply(null,t),e.apply(null,t)})},i.success=n(i.success,r.resolve),i.error=n(i.error,r.reject),s=t(i),a=r.promise(),a.abort=function(){return s.abort()},a}),t.when=m},"undefined"!=typeof n?(n.Deferred=function(){return new e},n.when=m,n.installInto=f):"function"==typeof t&&t.amd?t(function(){return"undefined"!=typeof Zepto?f(Zepto):(e.when=m,e.installInto=f,e)}):"undefined"!=typeof Zepto?f(Zepto):(this.Deferred=function(){return new e},this.Deferred.when=m,this.Deferred.installInto=f)}).call(this)},{}],13:[function(t,e,i){!function(){"use strict";function i(t,e){t.renderTarget.setColorTarget(t.cubeMap,c[e]),t.renderTarget.clear()}function n(t,e){var i,n;switch(t){case"+x":i=[1,0,0],n=[0,-1,0];break;case"-x":i=[-1,0,0],n=[0,-1,0];break;case"+y":i=[0,1,0],n=[0,0,1];break;case"-y":i=[0,-1,0],n=[0,0,-1];break;case"+z":i=[0,0,1],n=[0,-1,0];break;case"-z":i=[0,0,-1],n=[0,-1,0]}return new d({origin:e,forward:i,up:n,projection:{fov:90,aspect:1,zMin:1,zMax:1e3}})}function r(t){var e=this.gl=a.get();t=t||{},this.id=e.createFramebuffer(),this.resolution=t.resolution||l,this.depthTexture=new o({format:"DEPTH_COMPONENT",type:"UNSIGNED_SHORT",width:this.resolution,height:this.resolution}),this.cubeMap=new h({data:null,width:this.resolution,height:this.resolution}),this.renderTarget=new s,this.renderTarget.setDepthTarget(this.depthTexture),this.viewport=new u}var a=t("./WebGLContext"),s=t("./RenderTarget"),o=t("./Texture2D"),h=t("./TextureCubeMap"),u=t("./Viewport"),d=t("../render/Camera"),f=["-x","+x","-y","+y","-z","+z"],c={"+z":"TEXTURE_CUBE_MAP_POSITIVE_Z","-z":"TEXTURE_CUBE_MAP_NEGATIVE_Z","+x":"TEXTURE_CUBE_MAP_POSITIVE_X","-x":"TEXTURE_CUBE_MAP_NEGATIVE_X","+y":"TEXTURE_CUBE_MAP_POSITIVE_Y","-y":"TEXTURE_CUBE_MAP_NEGATIVE_Y"},l=2048;r.prototype.push=function(t){return this.cubeMap.push(t),this},r.prototype.pop=function(t){return this.cubeMap.pop(t),this},r.prototype.render=function(t,e,r){var a=this;return this.renderTarget.push(),this.viewport.push(this.resolution,this.resolution),f.forEach(function(s){i(a,s),e.render(n(s,t),r)}),this.renderTarget.pop(),this.viewport.pop(),this},e.exports=r}()},{"../render/Camera":26,"./RenderTarget":15,"./Texture2D":18,"./TextureCubeMap":19,"./Viewport":22,"./WebGLContext":23}],14:[function(t,e,i){!function(){"use strict";function i(t,e){e=e||{},this.gl=n.get(),this.id=0,this.count=0,this.offset=void 0!==e.offset?e.offset:0,this.mode=e.mode||"TRIANGLES",t instanceof WebGLBuffer?(this.id=t,this.type=e.type||"UNSIGNED_SHORT",this.count=void 0!==e.count?e.count:0):this.bufferData(t)}var n=t("./WebGLContext"),r=null;i.prototype.bufferData=function(t){var e=this.gl,i=n.checkExtension("OES_element_index_uint");if(i?t instanceof Array&&(t=new Uint32Array(t)):t instanceof Array?t=new Uint16Array(t):t instanceof Uint32Array&&(console.warn("Cannot create IndexBuffer of format gl.UNSIGNED_INT as OES_element_index_uint is not supported, defaulting to gl.UNSIGNED_SHORT"),t=new Uint16Array(t)),t instanceof Uint16Array)this.type="UNSIGNED_SHORT";else{if(!(t instanceof Uint32Array))return void console.error("IndexBuffer requires an Array or ArrayBuffer argument, command ignored");this.type="UNSIGNED_INT"}return this.id=e.createBuffer(),this.count=t.length,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.id),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW),this},i.prototype.bind=function(){if(r!==this){var t=this.gl;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.id),r=this,this}},i.prototype.unbind=function(){if(null!==r){var t=this.gl;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),r=null,this}},i.prototype.draw=function(t){if(t=t||{},null===r)return void console.warn("No IndexBuffer is bound, command ignored.");var e=this.gl,i=e[t.mode]||e[this.mode],n=void 0!==t.offset?t.offset:this.offset,a=void 0!==t.count?t.count:this.count;return e.drawElements(i,a,e[this.type],n),this},e.exports=i}()},{"./WebGLContext":23}],15:[function(t,e,i){!function(){"use strict";function i(t){if(h!==t){var e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,t.id),h=t}}function n(t){if(null!==h){var e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),h=null}}function r(){var t=this.gl=a.get();return this.id=t.createFramebuffer(),this.textures={},this}var a=t("./WebGLContext"),s=t("../util/Stack"),o=new s,h=null;r.prototype.push=function(){return o.push(this),i(this),this},r.prototype.pop=function(){var t;return o.pop(),t=o.top(),t?i(t):n(this),this},r.prototype.setColorTarget=function(t,e,i){var n=this.gl;return"string"==typeof e&&(i=e,e=void 0),e=void 0!==e?e:0,this.textures["color"+e]=t,this.push(),n.framebufferTexture2D(n.FRAMEBUFFER,n["COLOR_ATTACHMENT"+e],n[i||"TEXTURE_2D"],t.id,0),this.pop(),this},r.prototype.setDepthTarget=function(t){var e=this.gl;return this.textures.depth=t,this.push(),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,t.id,0),this.pop(),this},r.prototype.clearColor=function(t,e,i,n){var r=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,i=void 0!==i?i:0,n=void 0!==n?n:0,this.push(),r.clearColor(t,e,i,n),r.clear(r.COLOR_BUFFER_BIT),this.pop(),this},r.prototype.clearDepth=function(t,e,i,n){var r=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,i=void 0!==i?i:0,n=void 0!==n?n:0,this.push(),r.clearColor(t,e,i,n),r.clear(r.DEPTH_BUFFER_BIT),this.pop(),this},r.prototype.clearStencil=function(t,e,i,n){var r=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,i=void 0!==i?i:0,n=void 0!==n?n:0,this.push(),r.clearColor(t,e,i,n),r.clear(r.STENCIL_BUFFER_BIT),this.pop(),this},r.prototype.clear=function(t,e,i,n){var r=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,i=void 0!==i?i:0,n=void 0!==n?n:0,this.push(),r.clearColor(t,e,i,n),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this.pop(),this},r.prototype.resize=function(t,e){var i;if(!t||!e)return console.warn("Width or height arguments missing, command ignored."),this;for(i in this.textures)this.textures.hasOwnProperty(i)&&this.textures[i].resize(t,e);return this},e.exports=r}()},{"../util/Stack":40,"./WebGLContext":23}],16:[function(t,e,i){!function(){"use strict";function i(t,e){var i,n,r=p.parseDeclarations([t,e],["uniform","attribute"]),a={},s={},o=0;for(n=0;n<r.length;n++)i=r[n],"attribute"===i.qualifier?a[i.name]={type:i.type,index:o++}:"uniform"===i.qualifier&&(s[i.name]={type:i.type,func:v[i.type]});return{attributes:a,uniforms:s}}function n(t,e,i){var n=t.createShader(t[i]);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(n)),null)}function r(t){var e,i=t.gl,n=t.attributes;for(e in n)n.hasOwnProperty(e)&&i.bindAttribLocation(t.id,n[e].index,e)}function a(t){var e,i,n=t.gl,r=t.uniforms;for(i in r)r.hasOwnProperty(i)&&(e=r[i],e.location=n.getUniformLocation(t.id,i))}function s(t){return function(e){y.load(t,{responseType:"text",success:e,error:function(t){console.error(t),e(null)}})}}function o(t){return function(e){e(t)}}function h(t){return function(e){var i=[];t=t||[],t=t instanceof Array?t:[t],t.forEach(function(t){p.isGLSL(t)?i.push(o(t)):i.push(s(t))}),m.async(i,function(t){e(t)})}}function u(t){w!==t&&(t.gl.useProgram(t.id),w=t)}function d(t){null!==w&&(t.gl.useProgram(null),w=null)}function f(t){return t.id=null,t.attributes=null,t.uniforms=null,t}function c(t,e){var i=this;t=t||{},this.id=0,this.gl=l.get(),this.version=t.version||"1.00",t.vert||console.error("Vertex shader argument has not been provided, shader initialization aborted."),t.frag||console.error("Fragment shader argument has not been provided, shader initialization aborted."),m.async({common:h(t.common),vert:h(t.vert),frag:h(t.frag)},function(t){i.create(t),e&&e(i)})}var l=t("./WebGLContext"),p=t("./ShaderParser"),m=t("../util/Util"),y=t("../util/XHRLoader"),g=t("../util/Stack"),v={bool:"uniform1i","float":"uniform1f","int":"uniform1i",uint:"unfirom1i",vec2:"uniform2fv",ivec2:"uniform2iv",vec3:"uniform3fv",ivec3:"uniform3iv",vec4:"uniform4fv",ivec4:"uniform4iv",mat2:"uniformMatrix2fv",mat3:"uniformMatrix3fv",mat4:"uniformMatrix4fv",sampler2D:"uniform1i",samplerCube:"uniform1i"},x=new g,w=null;c.prototype.create=function(t){var e,s,o,h=this.gl,u=t.common.join(""),d=t.vert.join(""),c=t.frag.join("");return e=n(h,u+d,"VERTEX_SHADER"),s=n(h,u+c,"FRAGMENT_SHADER"),e&&s?(o=i(d,c),this.attributes=o.attributes,this.uniforms=o.uniforms,this.id=h.createProgram(),h.attachShader(this.id,e),h.attachShader(this.id,s),r(this),h.linkProgram(this.id),h.getProgramParameter(this.id,h.LINK_STATUS)?(a(this),this):(console.error("An error occured linking the shader: "+h.getProgramInfoLog(this.id)),console.error("Aborting instantiation of shader due to linking errors."),f(this))):(console.error("Aborting instantiation of shader due to compilation errors."),f(this))},c.prototype.push=function(){return x.push(this),u(this),this},c.prototype.pop=function(){var t;return x.pop(),t=x.top(),t?u(t):d(this),this},c.prototype.setUniform=function(t,e){if(!this.id)return void(this.hasLoggedError||(console.warn("Attempting to use an incomplete shader, ignoring command."),this.hasLoggedError=!0));var i,n,r,a,s=this.uniforms[t];if(!s)return void console.warn('No uniform found under name "'+t+'", command ignored');if(void 0===e)return void console.warn('Argument passed for uniform "'+t+'" is undefined, command ignored');switch(i=s.func,n=s.type,r=s.location,a=e.toArray?e.toArray():e,a=a instanceof Array?new Float32Array(a):a,a="boolean"==typeof a?a?1:0:a,n){case"mat2":case"mat3":case"mat4":this.gl[i](r,!1,a);break;default:this.gl[i](r,a)}return this},e.exports=c}()},{"../util/Stack":40,"../util/Util":41,"../util/XHRLoader":42,"./ShaderParser":17,"./WebGLContext":23}],17:[function(t,e,i){!function(){"use strict";function t(t){return t.replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")}function i(t){return t.replace(/(\r\n|\n|\r)/gm,"").replace(/\s{2,}/g," ")}function n(t){function e(t){var e=t.split(/[\[\]]/).map(function(t){return t.trim()});return{qualifier:r,precision:a,type:o,name:e[0],count:void 0===e[1]?1:parseInt(e[1],10)}}var i,n,r,a,o,h,u,d=[];for(i=t.split(",").map(function(t){return t.trim()}),n=i.shift().split(" "),r=n.shift(),a=n.shift(),s[a]?o=n.shift():(o=a,a=null),h=n.concat(i),u=0;u<h.length;u++)d.push(e(h[u]));return d}function r(e,r){var a,s,o=r instanceof Array?r.join("|"):r,h=new RegExp("^.*\\b("+o+")\\b.*","gm"),u=t(e),d=i(u),f=d.split(";"),c=[];for(s=0;s<f.length;s++)a=f[s].trim().match(h),a&&(c=c.concat(n(a[0])));return c}function a(t){var e={};return t.filter(function(t){return e[t.name]?!1:(e[t.name]=!0,!0)})}var s={highp:!0,mediump:!0,lowp:!0};e.exports={parseDeclarations:function(t,e){if(!e||0===e.length)return[];var i,n=t instanceof Array?t:[t],s=[];for(i=0;i<n.length;i++)s=s.concat(r(n[i],e));return a(s)},isGLSL:function(t){return/void\s+main\s*\(\s*\)\s*/.test(t)}}}()},{}],18:[function(t,e,i){!function(){"use strict";function i(t){if(!o.isPowerOfTwo(t.width)||!o.isPowerOfTwo(t.height)){var e=document.createElement("canvas");e.width=o.nextHighestPowerOfTwo(t.width),e.height=o.nextHighestPowerOfTwo(t.height);var i=e.getContext("2d");return i.drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),e}return t}function n(t,e){if(d!==t){var i=t.gl;e=i["TEXTURE"+e]||i.TEXTURE0,i.activeTexture(e),i.bindTexture(i.TEXTURE_2D,t.id),d=t}}function r(t){if(null!==d){var e=t.gl;e.bindTexture(e.TEXTURE_2D,null),d=null}}function a(t,e){var i=this;if(t=t||{},this.gl=s.get(),this.id=this.gl.createTexture(),this.wrap=t.wrap||"REPEAT",this.filter=t.filter||"LINEAR",this.invertY=void 0!==t.invertY?t.invertY:!0,t.image)this.bufferData(t.image),this.setParameters(this);else if(t.url){var n=new Image;n.onload=function(){i.bufferData(n),i.setParameters(i),e(i)},n.src=t.url}else{if("DEPTH_COMPONENT"===t.format){var r=s.checkExtension("WEBGL_depth_texture");if(!r)return void console.log("Cannot create Texture2D of format gl.DEPTH_COMPONENT as WEBGL_depth_texture is unsupported by this browser, command ignored");this.format=t.format,t.type&&"UNSIGNED_SHORT"!==t.type&&"UNSIGNED_INT"!==t.type?(console.log("Depth textures do not support type'"+t.type+"', defaulting to 'UNSIGNED_SHORT'."),this.type="UNSIGNED_SHORT"):this.type=t.type}else this.format=t.format||"RGBA",this.type=t.type||"UNSIGNED_BYTE";this.internalFormat=this.format,this.mipMap=void 0!==t.mipMap?t.mipMap:!1,this.bufferData(t.data||null,t.width,t.height),this.setParameters(this)}}var s=t("./WebGLContext"),o=t("../util/Util"),h=t("../util/Stack"),u={},d=null;a.prototype.push=function(t){return u[t]=u[t]||new h,u[t].push(this),n(this,t),this},a.prototype.pop=function(t){var e;return u[t]||console.warn("No texture was bound to texture unit '"+t+"'. Command ignored."),u[t].pop(),e=u[t].top(),e?n(e,t):r(this),this},a.prototype.bufferData=function(t,e,n){var r=this.gl;return this.push(),t instanceof HTMLImageElement?(this.width=t.width,this.height=t.height,t=i(t),this.image=t,this.mipMap=!0,r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.invertY),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)):(this.data=t,this.width=e||this.width,this.height=n||this.height,r.texImage2D(r.TEXTURE_2D,0,r[this.internalFormat],this.width,this.height,0,r[this.format],r[this.type],this.data)),this.mipMap&&r.generateMipmap(r.TEXTURE_2D),this.pop(),this},a.prototype.setParameters=function(t){var e=this.gl;if(this.push(),t.wrap&&(this.wrap=t.wrap,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e[this.wrap.s||this.wrap]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e[this.wrap.t||this.wrap])),t.filter){this.filter=t.filter;var i=this.filter.min||this.filter;this.mipMap&&(i+="_MIPMAP_LINEAR"),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[this.filter.mag||this.filter]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[i])}return this.pop(),this},a.prototype.resize=function(t,e){return this.image?void console.error("Cannot resize image based Texture2D"):t&&e?(this.bufferData(this.data,t,e),this):void console.warn("Width or height arguments missing, command ignored.")},e.exports=a}()},{"../util/Stack":40,"../util/Util":41,"./WebGLContext":23}],19:[function(t,e,i){!function(){"use strict";function i(t){if(!h.isPowerOfTwo(t.width)||!h.isPowerOfTwo(t.height)){var e=document.createElement("canvas");e.width=h.nextHighestPowerOfTwo(t.width),e.height=h.nextHighestPowerOfTwo(t.height);var i=e.getContext("2d");return i.drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),e}return t}function n(t,e){if(l!==t){var i=t.gl;e=i["TEXTURE"+e]||i.TEXTURE0,i.activeTexture(e),i.bindTexture(i.TEXTURE_CUBE_MAP,t.id),l=t}}function r(t){if(null!==l){var e=t.gl;e.bindTexture(e.TEXTURE_CUBE_MAP,null),l=null}}function a(t,e,i){return function(n){var r=new Image;r.onload=function(){t.bufferFaceData(i,r),n()},r.src=e}}function s(t,e){var i,n,r=this;if(this.gl=o.get(),this.id=this.gl.createTexture(),this.wrap=t.wrap||"CLAMP_TO_EDGE",this.filter=t.filter||"LINEAR",this.invertY=void 0!==t.invertY?t.invertY:!1,t.images){for(i in t.images)t.images.hasOwnProperty(i)&&this.bufferFaceData(i,t.images[i]);this.setParameters(this)}else if(t.urls){n={};for(i in t.urls)t.urls.hasOwnProperty(i)&&(n[i]=a(this,t.urls[i],i));h.async(n,function(){r.setParameters(r),e(r)})}else this.format=t.format||"RGBA",this.internalFormat=this.format,this.type=t.type||"UNSIGNED_BYTE",this.mipMap=void 0!==t.mipMap?t.mipMap:!1,d.forEach(function(e){var i=(t.data?t.data[e]:t.data)||null;r.bufferFaceData(e,i,t.width,t.height)}),this.setParameters(this)}var o=t("./WebGLContext"),h=t("../util/Util"),u=t("../util/Stack"),d=["-x","+x","-y","+y","-z","+z"],f={"+z":"TEXTURE_CUBE_MAP_POSITIVE_Z","-z":"TEXTURE_CUBE_MAP_NEGATIVE_Z","+x":"TEXTURE_CUBE_MAP_POSITIVE_X","-x":"TEXTURE_CUBE_MAP_NEGATIVE_X","+y":"TEXTURE_CUBE_MAP_POSITIVE_Y","-y":"TEXTURE_CUBE_MAP_NEGATIVE_Y"},c={},l=null;s.prototype.push=function(t){return c[t]=c[t]||new u,c[t].push(this),n(this,t),this},s.prototype.pop=function(t){var e;return c[t]||console.log("No texture was bound to texture unit '"+t+"'. Command ignored."),c[t].pop(),e=c[t].top(),e?n(e,t):r(this),this},s.prototype.bufferFaceData=function(t,e,n,r){var a=this.gl,s=a[f[t]];return s||console.log("Invalid face enumeration '"+t+"' provided, ignoring command."),this.push(),e instanceof HTMLImageElement?(this.images=this.images||{},this.images[t]=i(e),this.filter="LINEAR",this.mipMap=!0,a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,this.invertY),a.texImage2D(s,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.images[t])):(this.data=this.data||{},this.data[t]=e,this.width=n||this.width,this.height=r||this.height,a.texImage2D(s,0,a[this.internalFormat],this.width,this.height,0,a[this.format],a[this.type],e)),this.bufferedFaces=this.bufferedFaces||{},this.bufferedFaces[t]=!0,this.mipMap&&this.bufferedFaces["-x"]&&this.bufferedFaces["+x"]&&this.bufferedFaces["-y"]&&this.bufferedFaces["+y"]&&this.bufferedFaces["-z"]&&this.bufferedFaces["+z"]&&a.generateMipmap(a.TEXTURE_CUBE_MAP),this.pop(),this},s.prototype.setParameters=function(t){var e=this.gl;if(this.push(),t.wrap&&(this.wrap=t.wrap,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e[this.wrap.s||this.wrap]),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e[this.wrap.t||this.wrap])),t.filter){this.filter=t.filter;var i=this.filter.min||this.filter;this.minMap&&(i+="_MIPMAP_LINEAR"),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e[this.filter.mag||this.filter]),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e[i])}return this.pop(),this},e.exports=s}()},{"../util/Stack":40,"../util/Util":41,"./WebGLContext":23}],20:[function(t,e,i){!function(){"use strict";function i(t,e){return e?void(t.pointers=e):void console.error("VertexBuffer requires attribute pointers to be specified, command ignored")}function n(t,e){this.id=0,this.pointers={},this.gl=r.get(),t&&(t instanceof a?(this.bufferData(t.buffer()),i(this,t.attributePointers())):t instanceof WebGLBuffer?(this.id=t,i(this,e)):(this.bufferData(t),i(this,e)))}var r=t("./WebGLContext"),a=t("./VertexPackage"),s=t("../util/Util"),o=null,h=null;n.prototype.bufferData=function(t){var e=this.gl;if(t instanceof Array)t=new Float32Array(t);else if(!s.isTypedArray(t)&&"number"!=typeof t)return void console.error("VertexBuffer requires an Array or ArrayBuffer, or a size argument, command ignored");this.id||(this.id=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.id),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)},n.prototype.bufferSubData=function(t,e){var i=this.gl;if(!this.id)return void console.error("VertexBuffer has not been initially buffered, command ignored");if(t instanceof Array)t=new Float32Array(t);else if(!s.isTypedArray(t))return void console.error("VertexBuffer requires an Array or ArrayBuffer argument, command ignored");e=void 0!==e?e:0,i.bindBuffer(i.ARRAY_BUFFER,this.id),i.bufferSubData(i.ARRAY_BUFFER,e,t)},n.prototype.bind=function(){if(o!==this){var t,e,i=this.gl,n=this.pointers,r=h||{};o=this,h={},i.bindBuffer(i.ARRAY_BUFFER,this.id);for(e in n)n.hasOwnProperty(e)&&(t=this.pointers[e],i.vertexAttribPointer(e,t.size,i[t.type],!1,t.stride,t.offset),i.enableVertexAttribArray(e),h[e]=!0,delete r[e]);for(e in r)r.hasOwnProperty(e)&&i.disableVertexAttribArray(e)}},n.prototype.draw=function(t){if(t=t||{},!t.count)return void console.warn("Count must be defined, ignoring command.");var e=this.gl,i=e[t.mode.toUpperCase()]||e.POINTS,n=void 0!==t.offset?t.offset:0,r=t.count;e.drawArrays(i,n,r)},n.prototype.unbind=function(){if(null!==o){var t,e=this.gl,i=this.pointers;for(t in i)i.hasOwnProperty(t)&&e.disableVertexAttribArray(t);e.bindBuffer(e.ARRAY_BUFFER,null),o=null,h={}}},e.exports=n}()},{"../util/Util":41,"./VertexPackage":21,"./WebGLContext":23}],21:[function(t,e,i){!function(){"use strict";function t(t){var e,i,n=[];for(i=0;i<t.length;i++)e=t[i],e&&e instanceof Array&&e.length>0?n.push(e):console.error("Error parsing attribute of index "+i+", attribute discarded");return n}function i(t){return void 0!==t.x?void 0!==t.y?void 0!==t.z?void 0!==t.w?4:3:2:1:t instanceof Array?t.length:1}function n(t,e){var n,r,a,s=Number.MAX_VALUE,o=0;for(t.pointers={},a=0;a<e.length;a++)n=e[a],r=i(n[0]),s=Math.min(s,n.length),t.pointers[a]={type:"FLOAT",size:r,offset:o},o+=r;t.stride=o,t.size=s}function r(t){return t[0]instanceof Array||(t=[t]),this.set(t)}r.prototype.set=function(e){var i,r,a,s,o,h,u,d=4;for(e=t(e),n(this,e),this.data=new Float32Array(this.size*this.stride),o=0;o<e.length;o++){for(i=e[o],r=this.pointers[o],s=r.offset,h=0;h<this.size;h++)switch(a=i[h],u=s+this.stride*h,r.size){case 2:this.data[u]=void 0!==a.x?a.x:a[0],this.data[u+1]=void 0!==a.y?a.y:a[1];break;case 3:this.data[u]=void 0!==a.x?a.x:a[0],this.data[u+1]=void 0!==a.y?a.y:a[1],this.data[u+2]=void 0!==a.z?a.z:a[2];break;case 4:this.data[u]=void 0!==a.x?a.x:a[0],this.data[u+1]=void 0!==a.y?a.y:a[1],this.data[u+2]=void 0!==a.z?a.z:a[2],this.data[u+3]=void 0!==a.w?a.w:a[3];break;default:this.data[u]=void 0!==a.x?a.x:a[0]}r.stride=this.stride*d,r.offset=r.offset*d}return this},r.prototype.buffer=function(){return this.data},r.prototype.attributePointers=function(){return this.pointers},e.exports=r}()},{}],22:[function(t,e,i){!function(){"use strict";function i(t,e,i){var n=t.gl;e&&i?n.viewport(0,0,e,i):n.viewport(0,0,t.width,t.height)}function n(t){t=t||{},this.gl=r.get(),this.resize(t.width||window.innerWidth,t.height||window.innerHeight)}var r=t("./WebGLContext"),a=t("../util/Stack"),s=new a;n.prototype.resize=function(t,e){return t&&e&&(this.width=t,this.height=e,this.gl.canvas.height=e,this.gl.canvas.width=t),this},n.prototype.push=function(t,e){return s.push({viewport:this,width:t,height:e}),i(this,t,e),this},n.prototype.pop=function(){var t;return s.pop(),t=s.top(),t?i(t.viewport,t.width,t.height):i(this),this},e.exports=n}()},{"../util/Stack":40,"./WebGLContext":23}],23:[function(t,e,i){!function(){"use strict";function t(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement?t:"string"==typeof t?document.getElementById(t):null}function i(t){var e,i,n=t.gl;for(i=0;i<s.length;i++)e=s[i],t.extensions[e]=n.getExtension(e),t.extensions[e]?console.log(e+" extension loaded successfully"):console.log(e+" extension not supported")}function n(t,e){var n,s;try{s=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),n={id:t.id,gl:s,extensions:{}},i(n),a[t.id]=n,r||(r=n)}catch(o){console.error(o.message)}return s||console.error("Unable to initialize WebGL. Your browser may not support it."),n}var r=null,a={},s=["OES_texture_float","OES_texture_half_float","WEBGL_lose_context","OES_standard_derivatives","OES_vertex_array_object","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_frag_depth","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_blend_minmax","EXT_shader_texture_lod"];e.exports={bind:function(e){var i=t(e);return i?a[i.id]?(r=a[i.id],this):void console.error("No context exists for provided argument '"+e+"', command ignored."):(console.error("Context could not be bound for argument of type '"+typeof e+"', command ignored."),this)},get:function(e,i){if(!e)return r?r.gl:(console.error("No context is currently bound or provided, returning 'null'."),null);var s=t(e);return s&&(a[s.id]||n(s,i))?a[s.id].gl:(console.error("Context could not be found or created for argument of type'"+typeof e+"', returning 'null'."),null)},checkExtension:function(e,i){var n,s,o;return i?(o=t(e),o&&(s=a[o.id])):(i=e,s=r),s?(n=s.extensions,n[i]?n[i]:!1):(console.error("No context is currently bound or provided as argument, returning false."),!1)}}}()},{}],24:[function(t,e,i){!function(){"use strict";e.exports={CubeMapRenderTarget:t("./core/CubeMapRenderTarget"),RenderTarget:t("./core/RenderTarget"),Shader:t("./core/Shader"),Texture2D:t("./core/Texture2D"),TextureCubeMap:t("./core/TextureCubeMap"),VertexBuffer:t("./core/VertexBuffer"),VertexPackage:t("./core/VertexPackage"),IndexBuffer:t("./core/IndexBuffer"),Viewport:t("./core/Viewport"),WebGLContext:t("./core/WebGLContext"),Camera:t("./render/Camera"),Entity:t("./render/Entity"),Geometry:t("./render/Geometry"),Material:t("./render/Material"),Mesh:t("./render/Mesh"),Joint:t("./render/Joint"),Octree:t("./render/Octree"),Renderable:t("./render/Renderable"),Renderer:t("./render/Renderer"),RenderPass:t("./render/RenderPass"),RenderTechnique:t("./render/RenderTechnique"),Skeleton:t("./render/Skeleton"),Sprite:t("./render/Sprite"),Cube:t("./util/shapes/Cube"),Cylinder:t("./util/shapes/Cylinder"),Quad:t("./util/shapes/Quad"),ShapeUtil:t("./util/shapes/ShapeUtil"),Sphere:t("./util/shapes/Sphere"),glTFLoader:t("./util/gltf/glTFLoader"),OBJMTLLoader:t("./util/obj/OBJMTLLoader"),Util:t("./util/Util"),Debug:t("./util/debug/Debug"),Mat33:t("alfador").Mat33,Mat44:t("alfador").Mat44,Vec2:t("alfador").Vec2,Vec3:t("alfador").Vec3,Vec4:t("alfador").Vec4,Quaternion:t("alfador").Quaternion,Transform:t("alfador").Transform,Triangle:t("alfador").Triangle}}()},{"./core/CubeMapRenderTarget":13,"./core/IndexBuffer":14,"./core/RenderTarget":15,"./core/Shader":16,"./core/Texture2D":18,"./core/TextureCubeMap":19,"./core/VertexBuffer":20,"./core/VertexPackage":21,"./core/Viewport":22,"./core/WebGLContext":23,"./render/Camera":26,"./render/Entity":27,"./render/Geometry":28,"./render/Joint":29,"./render/Material":30,"./render/Mesh":31,"./render/Octree":32,"./render/RenderPass":33,"./render/RenderTechnique":34,"./render/Renderable":35,"./render/Renderer":36,"./render/Skeleton":37,"./render/Sprite":38,"./util/Util":41,"./util/debug/Debug":43,"./util/gltf/glTFLoader":45,"./util/obj/OBJMTLLoader":53,"./util/shapes/Cube":54,"./util/shapes/Cylinder":55,"./util/shapes/Quad":56,"./util/shapes/ShapeUtil":57,"./util/shapes/Sphere":58,alfador:9}],25:[function(t,e,i){!function(){"use strict";function t(t){return this.targets=t.targets,this}e.exports=t}()},{}],26:[function(t,e,i){!function(){"use strict";function i(t){var e;if(t=t||{},r.call(this,t),t.id&&(this.id=t.id),t.projection?this.projectionMatrix(t.projection):this.projectionMatrix({fov:45,aspect:4/3,minZ:.1,maxZ:1e3}),this.parent=t.parent||null,this.children=[],t.children)for(e=0;e<t.children.length;e++)this.addChild(t.children[e]);return this}var n=t("alfador"),r=n.Transform,a=n.Mat44,s=t("./Entity");i.prototype=Object.create(s.prototype),i.prototype.projectionMatrix=function(t){return t?(t instanceof Array?this.projection=new a(t):t instanceof a?this.projection=t:this.projection=a.perspective(t.fov||45,t.aspect||4/3,t.zMin||.1,t.zMax||1e3),this):this.projection},i.prototype.copy=function(){var t,e=new i({up:this.up(),forward:this.forward(),origin:this.origin(),projection:new a(this.projection)});for(t=0;t<this.children.length;t++)e.addChild(this.children[t].copy());return e},e.exports=i}()},{"./Entity":27,alfador:9}],27:[function(t,e,i){!function(){"use strict";function i(t){var e=this;if(t=t||{},n.call(this,t),t.id&&(this.id=t.id),this.parent=t.parent||null,this.children=[],t.children&&t.children.forEach(function(t){
e.addChild(t)}),this.meshes=[],t.meshes&&t.meshes.forEach(function(t){t instanceof r?e.meshes.push(t):e.meshes.push(new r(t))}),this.sprites=[],t.sprites&&t.sprites.forEach(function(t){t instanceof a?e.sprites.push(t):e.sprites.push(new a(t))}),this.skeleton=null,t.skeleton&&(t.skeleton instanceof s?this.skeleton=t.skeleton:this.skeleton=new s(t.skeleton)),this.animations={},t.animations)for(var i in t.animations)t.animations.hasOwnProperty(i)&&(t.animations[i]instanceof o?this.animations[i]=t.animations:this.animations[i]=new o(t.animations))}var n=t("alfador").Transform,r=t("./Mesh"),a=t("./Sprite"),s=t("./Skeleton"),o=t("./Animation");i.prototype=Object.create(n.prototype),i.prototype.globalMatrix=function(){return this.parent?this.parent.globalMatrix().mult(this.matrix()):this.matrix()},i.prototype.globalViewMatrix=function(){return this.parent?this.parent.mult(this.matrix()).viewMatrix():this.viewMatrix()},i.prototype.addChild=function(t){return t instanceof i||(t=new i(t)),t.parent=this,this.children.push(t),this},i.prototype.removeChild=function(t){var e=this.children.indexOf(t);return-1!==e&&(this.children.splice(e,1),t.parent=null),this},i.prototype.depthFirst=function(t){t(this),this.children.forEach(function(e){e.depthFirst(t)})},i.prototype.breadthFirst=function(t){for(var e=[this];e.length>0;){var i=e.shift();e=e.concat(e,i.children),t(i)}},i.prototype.copy=function(){var t=new i({up:this.up(),forward:this.forward(),origin:this.origin(),scale:this.scale(),meshes:this.meshes,sprites:this.sprites,skeleton:this.skeleton,animations:this.animations});return this.children.forEach(function(e){t.addChild(e.copy())}),t},e.exports=i}()},{"./Animation":25,"./Mesh":31,"./Skeleton":37,"./Sprite":38,alfador:9}],28:[function(t,e,i){!function(){"use strict";function t(t){this.positions=t.positions,this.uvs=t.uvs,this.normals=t.normals,this.tangents=t.tangents,this.bitangents=t.bitangents,this.indices=t.indices}e.exports=t}()},{}],29:[function(t,e,i){!function(){"use strict";function t(t){return this.id=t.id,this.name=t.name,this.bindMatrix=t.bindMatrix,this.inverseBindMatrix=t.inverseBindMatrix,this.parent=t.parent,this.children=t.children,this.index=t.index,this}t.prototype.skinningMatrix=function(t,e){return e=e||this.bindMatrix,this.parent?this.globalMatrix=this.parent.globalMatrix.mult(e):this.globalMatrix=e,this.globalMatrix.mult(this.inverseBindMatrix.mult(t))},e.exports=t}()},{}],30:[function(t,e,i){!function(){"use strict";function i(t){return t?t instanceof a?t:new a({image:t}):null}function n(t){return t instanceof Array?[t[0],t[1],t[2],t[3]||1]:t}function r(t){return t=t||{},this.id=t.id,this.diffuseColor=n(t.diffuseColor)||[1,0,1,1],this.diffuseTexture=i(t.diffuseTexture)||null,this.ambientColor=n(t.ambientColor)||[0,0,0,1],this.ambientTexture=i(t.ambientTexture)||null,this.specularColor=n(t.specularColor)||[1,1,1,1],this.specularTexture=i(t.specularTexture)||null,this.specularComponent=t.specularComponent||10,this.reflection=void 0!==t.reflection?t.reflection:0,this.refraction=void 0!==t.refraction?t.refraction:0,this}var a=t("../core/Texture2D");e.exports=r}()},{"../core/Texture2D":18}],31:[function(t,e,i){!function(){"use strict";function i(t){t=t||{},t.geometry?t.geometry instanceof n?this.geometry=t.geometry:this.geometry=new n(t.geometry):this.geometry=new n(t),t.renderable?t.renderable instanceof r?this.renderable=t.renderable:this.renderable=new r(t.renderable):this.renderable=new r(t),t.material?t.material instanceof a?this.material=t.material:this.material=new a(t.material):this.material=new a(t)}var n=t("./Geometry"),r=t("./Renderable"),a=t("./Material");i.prototype.draw=function(){return this.renderable.draw(),this},e.exports=i}()},{"./Geometry":28,"./Material":30,"./Renderable":35}],32:[function(t,e,i){!function(){"use strict";function i(t){var e,i,n,r,a,s=v,o=g;for(a=0;a<t.length;a++)e=t[a],i=e.a,n=e.b,r=e.c,s.x=Math.min(s.x,Math.min(Math.min(i.x,n.x),r.x)),s.y=Math.min(s.y,Math.min(Math.min(i.y,n.y),r.y)),s.z=Math.min(s.z,Math.min(Math.min(i.z,n.z),r.z)),o.x=Math.max(o.x,Math.max(Math.max(i.x,n.x),r.x)),o.y=Math.max(o.y,Math.max(Math.max(i.y,n.y),r.y)),o.z=Math.max(o.z,Math.max(Math.max(i.z,n.z),r.z));return{min:s,max:o}}function n(t,e,i){var n,r=new l(0,0,0);t.children[e]?t.children[e].insert(i):t.depth>0&&(n=t.halfWidth/2,r.x=1&e?n:-n,r.y=2&e?n:-n,r.z=4&e?n:-n,t.children[e]=new u(null,{center:t.center.add(r),halfWidth:n,depth:t.depth-1}),t.children[e].insert(i))}function r(t,e,i){var n,r,a=new l(t.center),s=t.halfWidth/2,o=0;return a.x+=1&i?s:-s,a.y+=2&i?s:-s,a.z+=4&i?s:-s,n=new l(a.x-s,a.y-s,a.z-s),r=new l(a.x+s,a.y+s,a.z+s),e.x<n.x&&(o+=(n.x-e.x)*(n.x-e.x)),e.x>r.x&&(o+=(e.x-r.x)*(e.x-r.x)),e.y<n.y&&(o+=(n.y-e.y)*(n.y-e.y)),e.y>r.y&&(o+=(e.y-r.y)*(e.y-r.y)),e.z<n.z&&(o+=(n.z-e.z)*(n.z-e.z)),e.z>r.z&&(o+=(e.z-r.z)*(e.z-r.z)),o}function a(t,e,i,n){var a=r(t,e,n);return i*i>=a}function s(){if(!d){var t=[[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1],[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1]],e=[0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4];d=new m({positions:t,indices:e,options:{mode:"LINES"}})}return d}function o(t){var e,i,n=[],r=0;for(e=new p({meshes:[s()],origin:t.center,scale:t.halfWidth}),i=0;8>i;i++)t.children[i]&&(n=n.concat(o(t.children[i])),r++);return(t.contained.length>0||r>0)&&n.push(new p({meshes:[s()],origin:t.center,scale:t.halfWidth})),n}function h(t){var e;for(e=0;e<t.length;e++)t[e]instanceof c||(t[e]=new c(t[e].positions));return t}function u(t,e){return e=e||{},t?this.build(t,e.depth||y):(this.center=e.center,this.halfWidth=e.halfWidth,this.depth=e.depth,this.clear()),this}var d,f=t("alfador"),c=f.Triangle,l=f.Vec3,p=t("./Entity"),m=t("./Mesh"),y=4,g=new l(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),v=new l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);u.prototype.build=function(t,e){var n,r,a,s,o,u;for(t=h(t),n=i(t),this.clear(),this.center=n.min.add(n.max).div(2),this.depth=e||y,r=n.min.sub(this.center),a=n.max.sub(this.center),s=Math.max(Math.abs(r.x),Math.max(Math.abs(r.y),Math.abs(r.z))),o=Math.max(Math.abs(a.x),Math.max(Math.abs(a.y),Math.abs(a.z))),this.halfWidth=Math.max(s,o),u=0;u<t.length;u++)this.insert(t[u])},u.prototype.clear=function(){this.entity=null,this.contained=[],this.children=[null,null,null,null,null,null,null,null]},u.prototype.insert=function(t){var e,i=t.centroid(),r=t.radius(),s=i.x-this.center.x,o=i.y-this.center.y,h=i.z-this.center.z;if(0===this.depth&&this.contained.push(t),Math.abs(s)<r||Math.abs(o)<r||Math.abs(h)<r)for(e=0;8>e;e++)a(this,i,r,e)&&n(this,e,t);else e=0,s>0&&(e+=1),o>0&&(e+=2),h>0&&(e+=4),n(this,e,t)},u.prototype.getEntity=function(){return this.entity||(this.entity=new p({children:o(this)})),this.entity},e.exports=u}()},{"./Entity":27,"./Mesh":31,alfador:9}],33:[function(t,e,i){!function(){"use strict";function t(e,i,n,r){i&&i(e),n&&e.meshes&&e.meshes.forEach(function(t){n(t,e)}),r&&e.sprites&&e.sprites.forEach(function(t){r(t,e)}),e.children.forEach(function(e){t(e,i,n,r)})}function i(t){return"object"==typeof t?(this.before=t.before||null,this.forEachEntity=t.forEachEntity||null,this.forEachMesh=t.forEachMesh||null,this.forEachSprite=t.forEachSprite||null,this.after=t.after||null):"function"==typeof t&&(this.before=t),this}i.prototype.execute=function(e,i){var n=this.before,r=this.forEachEntity,a=this.forEachMesh,s=this.forEachSprite,o=this.after;n&&n(e),i.forEach(function(e){e&&t(e,r,a,s)}),o&&o()},e.exports=i}()},{}],34:[function(t,e,i){!function(){"use strict";function t(t){return this.id=t.id,this.passes=t.passes||[],this}t.prototype.execute=function(t,e){this.passes.forEach(function(i){i.execute(t,e)})},e.exports=t}()},{}],35:[function(t,e,i){!function(){"use strict";function i(t){var e=[];return t.positions&&e.push(t.positions),t.normals&&e.push(t.normals),t.uvs&&e.push(t.uvs),t.tangents&&e.push(t.tangents),t.bitangents&&e.push(t.bitangents),t.colors&&e.push(t.colors),t.joints&&e.push(t.joints),t.weights&&e.push(t.weights),e}function n(t){if(t=t||{},t.vertexBuffer||t.vertexBuffers)this.vertexBuffers=t.vertexBuffers||[t.vertexBuffer];else{var e=new r(i(t));this.vertexBuffers=[new a(e)]}return t.indexBuffer?this.indexBuffer=t.indexBuffer:t.indices&&(this.indexBuffer=new s(t.indices,t.options)),this}var r=t("../core/VertexPackage"),a=t("../core/VertexBuffer"),s=t("../core/IndexBuffer");n.prototype.draw=function(t){return this.indexBuffer?(this.vertexBuffers.forEach(function(t){t.bind()}),this.indexBuffer.bind(),this.indexBuffer.draw(t)):this.vertexBuffers.forEach(function(e){e.bind(),e.draw(t.count,t)}),this},e.exports=n}()},{"../core/IndexBuffer":14,"../core/VertexBuffer":20,"../core/VertexPackage":21}],36:[function(t,e,i){!function(){"use strict";function t(t){return t instanceof Array||(t=[t]),this.techniques=t||[],this}t.prototype.render=function(t,e){this.techniques.forEach(function(i){var n=e[i.id];n&&n.length>0&&i.execute(t,n)})},e.exports=t}()},{}],37:[function(t,e,i){!function(){"use strict";function i(t,e){var n,r=e.length;for(n=0;n<e.length;n++)t[e[n].id]=e[n],r+=i(t,e[n].children);return r}function n(t){return this.root=t.root instanceof Array?t.root:[t.root],this.bindShapeMatrix=t.bindShapeMatrix||r.identity(),this.jointsById={},this.jointCount=i(this.jointsById,this.root),this}var r=t("alfador").Mat44;n.prototype.toFloat32Array=function(){var t,e,i,n,r=this.bindShapeMatrix,a=this.jointsById;t=new Float32Array(new ArrayBuffer(64*this.jointCount));for(n in a)a.hasOwnProperty(n)&&(i=a[n],e=i.skinningMatrix(r),t.set(e.data,16*i.index));return t},e.exports=n}()},{alfador:9}],38:[function(t,e,i){!function(){"use strict";function i(){return a||(a=new h({positions:d.positions(),indices:d.indices()})),a}function n(){return s||(s=new o({positions:d.positions(),indices:d.indices()})),s}function r(t){if(t=t||{},this.renderable=n(),this.geometry=i(),this.animations={},t.animations)for(var e in t.animations)t.animations.hasOwnProperty(e)&&this.addAnimation(e,t.animations[e])}var a,s,o=t("./Renderable"),h=t("./Geometry"),u=t("./SpriteAnimation"),d=t("../util/shapes/Quad");r.prototype.addAnimation=function(t,e){e instanceof u?this.animations[t]=e:this.animations[t]=new u(e)},r.prototype.getFrame=function(t,e){var i=this.animations[t];return i?i.getFrame(e):(console.warn('Animation of id"'+t+'" does not exist, returning null.'),null)},r.prototype.draw=function(){return this.renderable.draw(),this},e.exports=r}()},{"../util/shapes/Quad":56,"./Geometry":28,"./Renderable":35,"./SpriteAnimation":39}],39:[function(t,e,i){!function(){"use strict";function t(t,e){var i=t[e];return i?i.timestamp||e/t.length:null}function i(t){t=t||{};var e=this;return this.frames=[],t.frames&&t.frames.forEach(function(t){e.addFrame(t)}),this.shouldLoop=void 0!==t.shouldLoop?t.shouldLoop:!1,this}i.prototype.addFrame=function(t){var e=this;this.frames.push({channels:[],timestamp:t.timestamp}),t.channels?t.channels.forEach(function(t){e.addChannel(t,e.frames.length-1)}):t.texture&&this.addChannel(t,e.frames.length-1)},i.prototype.addChannel=function(t,e){this.frames[e].channels.push({texture:t.texture,x:void 0!==t.x?t.x:0,y:void 0!==t.y?t.y:0,width:void 0!==t.width?t.width:t.texture.width,height:void 0!==t.height?t.height:t.texture.height,origin:{x:t.origin.x,y:t.origin.y},flipX:void 0!==t.flipX?t.flipX:!1,scale:t.scale||{x:1,y:1},rotation:void 0!==t.rotation?t.rotation:0})},i.prototype.getFrame=function(e){this.shouldLoop&&(e%=1);for(var i=t(this.frames,0),n=0;null!==i&&e>=i;)i=t(this.frames,++n);return this.frames[n-1]},e.exports=i}()},{}],40:[function(t,e,i){!function(){"use strict";function t(){this.data=[]}t.prototype.push=function(t){return this.data.push(t),this},t.prototype.pop=function(){return this.data.pop(),this},t.prototype.top=function(){var t=this.data.length-1;return 0>t?null:this.data[t]},e.exports=t}()},{}],41:[function(t,e,i){!function(){"use strict";function i(t){return function(e){t.resolve(e)}}function n(t,e){var n,r,a=[];for(r=0;r<t.length;r++)n=new s,a.push(n),t[r](i(n));o.apply(o,a).then(function(){var t=Array.prototype.slice.call(arguments,0);e(t)})}function r(t,e){var n,r,a=[],h=[];for(r in t)t.hasOwnProperty(r)&&(n=new s,h.push(n),a.push(r),t[r](i(n)));o.apply(o,h).done(function(){var t,i=Array.prototype.slice.call(arguments,0),n={};for(t=0;t<a.length;t++)n[a[t]]=i[t];e(n)})}var a=t("simply-deferred"),s=a.Deferred,o=a.when;e.exports={async:function(t,e){t instanceof Array?n(t,e):r(t,e)},extend:function(t,e){var i;for(i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},copy:function(t){return JSON.parse(JSON.stringify(t))},isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},isTypedArray:function(t){return t&&t.buffer instanceof ArrayBuffer&&void 0!==t.byteLength},isPowerOfTwo:function(t){return 0!==t?0===(t&t-1):!1},nextHighestPowerOfTwo:function(t){var e;for(0!==t&&(t-=1),e=1;32>e;e<<=1)t|=t>>e;return t+1}}}()},{"simply-deferred":12}],42:[function(t,e,i){!function(){"use strict";e.exports={load:function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType=e.responseType,i.addEventListener("load",function(){e.success&&e.success(this.response)}),e.progress&&i.addEventListener("progress",function(t){e.progress(t)}),e.error&&i.addEventListener("error",function(t){e.error(t)}),i.send()}}}()},{}],43:[function(t,e,i){!function(){"use strict";function i(t){var e=t.toString();return e=e.substr("function ".length),e=e.substr(0,e.indexOf("("))}function n(t,e){t.$$DEBUG_UUID=t.$$DEBUG_UUID||F++;var n=t.$$DEBUG_UUID+"-"+i(e);return D[n]||(D[n]=e(t)),D[n]}function r(t){var e,i,n=new Array(t.length);for(i=0;i<t.length;i++)e=t[i],n[i]=[((e.x||e[0])+1)/2,((e.y||e[1])+1)/2,((e.z||e[2]||0)+1)/2];return n}function a(t){var e=t.copy();return e.forEach(function(t){var e,i,n,r,a,s,o,h,u,d,f,c=t.meshes;for(t.meshes=[],d=0;d<c.length;d++){for(e=c[d].geometry,i=e.positions,r=e.indices,a=new Array(2*r.length),s=new Array(2*r.length),f=0;f<r.length;f+=3)o=r[f],h=r[f+1],u=r[f+2],a[2*f]=i[o],a[2*f+1]=i[h],a[2*f+2]=i[h],a[2*f+3]=i[u],a[2*f+4]=i[u],a[2*f+5]=i[o],s[2*f]=2*f,s[2*f+1]=2*f+1,s[2*f+2]=2*f+2,s[2*f+3]=2*f+3,s[2*f+4]=2*f+4,s[2*f+5]=2*f+5;t.meshes.push(new I({positions:a,indices:s,options:{mode:"LINES"},material:n}))}t.$$DEBUG_USE_COLOR=!1}),e}function s(t,e){var i=t.copy();return i.forEach(function(t){var i,n,a=t.meshes;for(t.meshes=[],n=0;n<a.length;n++)i=a[n].geometry,t.meshes.push(new I({positions:i.positions,colors:r(i[e]),indices:i.indices}));t.$$DEBUG_USE_COLOR=!0}),i}function o(t){return s(t,"uvs")}function h(t){return s(t,"normals")}function u(t){return s(t,"tangents")}function d(t){return s(t,"bitangents")}function f(t,e){var i=t.copy();return i.forEach(function(t){var i,n,r,a,s,o,h,u,d=t.meshes;for(t.meshes=[],h=0;h<d.length;h++){for(r=d[h].geometry.positions,i=d[h].geometry[e],s=new Array(2*r.length),o=new Array(2*r.length),u=0;u<r.length;u++)a=r[u],n=i[u],s[2*u]=a,s[2*u+1]=[(a.x||a[0]||0)+(n.x||n[0]||0),(a.y||a[1]||0)+(n.y||n[1]||0),(a.z||a[2]||0)+(n.z||n[2]||0)],o[2*u]=2*u,o[2*u+1]=2*u+1;t.meshes.push(new I({positions:s,indices:o,options:{mode:"LINES"}})),t.$$DEBUG_USE_COLOR=!1}}),i}function c(t){return f(t,"uvs")}function l(t){return f(t,"normals")}function p(t){return f(t,"tangents")}function m(t){return f(t,"bitangents")}var y="uProjectionMatrix",g="uModelMatrix",v="uViewMatrix",x="aPosition",w="aTexCoord",b="uUseAttribColor",_="aColor",E="uColor",T="uDiffuseSampler",M=["attribute highp vec3 "+x+";","attribute highp vec3 "+_+";","uniform highp mat4 "+g+";","uniform highp mat4 "+v+";","uniform highp mat4 "+y+";","uniform bool "+b+";","uniform highp vec3 "+E+";","varying highp vec3 vColor;","void main() {","if ( "+b+" ) {","vColor = "+_+";","} else {","vColor = "+E+";","}","gl_Position = "+y+" * "+v+" * "+g+" * vec4( "+x+", 1.0 );","}"].join("\n"),A=["varying highp vec3 vColor;","void main() {","gl_FragColor = vec4( vColor, 1.0 );","}"].join("\n"),z=["attribute highp vec3 "+x+";","attribute highp vec2 "+w+";","uniform highp mat4 "+g+";","varying highp vec2 vTexCoord;","void main() {","gl_Position = "+g+" * vec4( "+x+", 1.0 );","vTexCoord = "+w+";","}"].join("\n"),R=["varying highp vec3 vColor;","uniform sampler2D "+T+";","varying highp vec2 vTexCoord;","void main() {","gl_FragColor = texture2D( "+T+", vTexCoord );","}"].join("\n"),S=null,U=null,C=t("../../core/Shader"),I=t("../../render/Mesh"),L=t("../../render/Entity"),P=t("../../render/Renderer"),N=t("../../render/RenderTechnique"),O=t("../../render/RenderPass"),B=t("../shapes/Quad"),F=1,D={},V=null,G=!1,k=[1,1,0],j=new O({before:function(t){S||(S=new C({vert:M,frag:A})),S.push(),S.setUniform(y,t.projectionMatrix()),S.setUniform(v,t.globalViewMatrix())},forEachEntity:function(t){G=t.$$DEBUG_USE_COLOR,S.setUniform(g,t.globalMatrix())},forEachMesh:function(t){S.setUniform(b,G),S.setUniform(E,k),t.draw()},after:function(){S.pop()}}),W=new O({before:function(){U||(U=new C({vert:z,frag:R})),U.gl.disable(U.gl.DEPTH_TEST),U.push(),U.setUniform(T,0)},forEachEntity:function(t){U.setUniform(g,t.globalMatrix())},forEachMesh:function(t){t.material.diffuseTexture.push(0),t.draw(),t.material.diffuseTexture.pop(0)},after:function(){U.gl.enable(U.gl.DEPTH_TEST),U.pop()}}),X=new N({id:"debug",passes:[j]}),q=new N({id:"tex",passes:[W]}),H=new P([X,q]);e.exports={setCamera:function(t){V=t},drawTexture:function(t){var e={positions:B.positions(),uvs:B.uvs(),indices:B.indices()},i=new L({meshes:[new I({renderable:e,geomertry:e,material:{diffuseTexture:t}})],origin:[-.75,.75,0],scale:.5});H.render(null,{tex:[i]})},drawWireFrame:function(t){H.render(V,{debug:[n(t,a)]})},drawUVsAsColor:function(t){H.render(V,{debug:[n(t,o)]})},drawUVsAsVectors:function(t,e){k=e,H.render(V,{debug:[n(t,c)]})},drawNormalsAsColor:function(t){H.render(V,{debug:[n(t,h)]})},drawNormalsAsVectors:function(t,e){k=e,H.render(V,{debug:[n(t,l)]})},drawTangentsAsColor:function(t){H.render(V,{debug:[n(t,u)]})},drawTangentsAsVectors:function(t,e){k=e,H.render(V,{debug:[n(t,p)]})},drawBiTangentsAsColor:function(t){H.render(V,{debug:[n(t,d)]})},drawBiTangentsAsVectors:function(t,e){k=e,H.render(V,{debug:[n(t,m)]})}}}()},{"../../core/Shader":16,"../../render/Entity":27,"../../render/Mesh":31,"../../render/RenderPass":33,"../../render/RenderTechnique":34,"../../render/Renderer":36,"../shapes/Quad":56}],44:[function(t,e,i){!function(){"use strict";function i(t,e,i,n,r){if(!t[n]){var a,s,o,h=e.accessors[n],l=e.bufferViews[h.bufferView],p=r[l.buffer],m=d[h.componentType],y=f[h.type],g=c[h.type],v=h.count*y,x=new m(p,l.byteOffset+h.byteOffset,v),w=[];if(g===Number)w=x;else if("rotation"===i)for(o=0;o<h.count;o++)a=o*y,s=a+y,w.push({axis:new u(x.subarray(a,s-1)),angle:x.subarray(s-1,s)[0]});else for(o=0;o<h.count;o++)a=o*y,s=a+y,w.push(new g(x.subarray(a,s)));t[n]=w}}function n(t,e,n,r,a){var s,o,h,u,d,f,c=r.parameters;for(f=0;f<r.channels.length;f++)s=r.channels[f],o=s.target,h=r.samplers[s.sampler],u=c[h.input],d=c[h.output],i(e,n,h.input,u,a),i(e,n,h.output,d,a),t[o.id]=t[o.id]||[],t[o.id].push({path:o.path,input:e[u],output:e[d]})}var r=t("alfador"),a=r.Quaternion,s=r.Mat33,o=r.Mat44,h=r.Vec2,u=r.Vec3,d={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5126:Float32Array},f={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},c={SCALAR:Number,VEC2:h,VEC3:u,VEC4:a,MAT3:s,MAT4:o};e.exports={createAnimations:function(t,e){var i,r={},a={};for(i in t.animations)t.animations.hasOwnProperty(i)&&n(r,a,t,t.animations[i],e);return r}}}()},{alfador:9}],45:[function(t,e,i){!function(){"use strict";function i(t,e,n,r){var a,o,u,d=t.nodes[r],c=[],p=[],m=null,y=null;if(d.jointName||d.camera||d.light)return null;for(a=s.getNodeMatrix(d).decompose(),u=0;u<d.children.length;u++)o=i(t,e,n,d.children[u]),o&&p.push(o);if(d.meshes)for(u=0;u<d.meshes.length;u++)c=c.concat(e[d.meshes[u]]);if(d.instanceSkin){for(m=f.createSkeleton(t,d.instanceSkin,n),u=0;u<d.instanceSkin.meshes.length;u++)c=c.concat(e[d.instanceSkin.meshes[u]]);y=h.createAnimations(t,n)}return new l({id:r,up:a.up,forward:a.forward,left:a.left,origin:a.origin,scale:a.scale,children:p,meshes:c,skeleton:m,animations:y})}function n(t,e,n){var r,a,s=t.scenes[t.scene].nodes,o=[];for(a=0;a<s.length;a++)r=i(t,e,n,s[a]),r&&o.push(r);return o}function r(t,e){c.async({buffers:function(e){s.requestBuffers(t.buffers,function(t){e(t)})},materials:function(e){o.loadMaterials(t,function(t){e(t)})}},function(i){var r=u.createMeshes(t,i.buffers,i.materials);e(n(t,r,i.buffers))})}var a=t("path"),s=t("./glTFUtil"),o=t("./glTFMaterial"),h=t("./glTFAnimation"),u=t("./glTFMesh"),d=t("./glTFParser"),f=t("./glTFSkeleton"),c=t("../Util"),l=t("../../render/Entity");e.exports={load:function(t,e){var i=a.basename(t,a.extname(t)),n=Object.create(d,{handleLoadCompleted:{value:function(){r(this.json,function(t){var n=new l({id:i,children:t});e(n)})}}});n.initWithPath(t),n.load(null,null)}}}()},{"../../render/Entity":27,"../Util":41,"./glTFAnimation":44,"./glTFMaterial":46,"./glTFMesh":47,"./glTFParser":48,"./glTFSkeleton":49,"./glTFUtil":50,path:10}],46:[function(t,e,i){!function(){"use strict";function i(t,e,i,n){var r=i[e];r&&("SAMPLER_2D"===p[r.type]?t[e+"Texture"]=n[r.value]:t[e+"Color"]=r.value)}function n(t,e,n){var r={id:t};return i(r,"ambient",e,n),i(r,"diffuse",e,n),i(r,"specular",e,n),e.shininess&&(r.specularComponent=e.shininess.value),new d(r)}function r(t,e){var i,n=o.copy(t.parameters),r=o.copy(e.values);for(i in r)r.hasOwnProperty(i)&&(n[i].value=r[i]);return n}function a(t,e){var i,a,s,o=t.materials,h=t.techniques,u={};for(s in o)o.hasOwnProperty(s)&&(i=o[s].instanceTechnique,a=r(h[i.technique],i),u[s]=n(s,a,e));return u}function s(t,e){var i,n,r=t.textures,a={};for(n in r)r.hasOwnProperty(n)&&(i=r[n],a[n]=new u({image:e[i.source],format:f[i.format]||f["default"],internalFormat:c[i.internalFormat]||c["default"],type:l[i.type]||l["default"],wrap:"REPEAT",invertY:!1}));return a}var o=t("../Util"),h=t("./glTFUtil"),u=t("../../core/Texture2D"),d=t("../../render/Material"),f={6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA","default":"RGBA"},c={6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA","default":"RGBA"},l={5121:"UNSIGNED_BYTE",33635:"UNSIGNED_SHORT_5_6_5",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1","default":"UNSIGNED_BYTE"},p={5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D"};e.exports={loadMaterials:function(t,e){h.requestImages(t.images,function(i){var n=s(t,i),r=a(t,n);e(r)})}}}()},{"../../core/Texture2D":18,"../../render/Material":30,"../Util":41,"./glTFUtil":50}],47:[function(t,e,i){!function(){"use strict";function i(t,e,i,n){if(!e)return null;var r=h.get(),a=i.accessors[e],s=a.bufferView,o=i.bufferViews[s],u=c[o.target],f=a.count*p[a.type],m=l[a.componentType];return t[s]||(t[s]=r.createBuffer(),u=c[o.target],r.bindBuffer(r[u],t[s]),r.bufferData(r[u],o.byteLength,r.STATIC_DRAW)),r.bufferSubData(r[u],a.byteOffset,new m(n[o.buffer],o.byteOffset+a.byteOffset,f)),{bufferView:s,size:p[a.type],type:d[a.componentType],stride:a.byteStride,offset:a.byteOffset,count:a.count}}function n(t,e,i){i&&(t[i.bufferView]=t[i.bufferView]||{},t[i.bufferView][e]=i)}function r(t,e,r,a,h){var d,c,l,p,m,y,g,v,x,w,b=e.attributes,_=e.indices,E=e.material,T={},M=[];c=i(t,b.POSITION||b.POSITION_0,r,a),l=i(t,b.NORMAL||b.NORMAL_0,r,a),p=i(t,b.TEXCOORD||b.TEXCOORD_0,r,a),y=i(t,b.JOINT||b.JOINT_0,r,a),g=i(t,b.WEIGHT||b.WEIGHT_0,r,a),m=i(t,b.COLOR||b.COLOR_0,r,a),n(T,"0",c),n(T,"1",l),n(T,"2",p),n(T,"3",y),n(T,"4",g);for(w in T)T.hasOwnProperty(w)&&(x=T[w],M.push(new s(t[w],x)));return v=i(t,_,r,a),v.mode=f[e.primitive]||f["default"],d=new o(t[v.bufferView],v),new u({vertexBuffers:M,indexBuffer:d,material:h[E]})}function a(t,e,i,n,a){var s,o=e.primitives,h=[];for(s=0;s<o.length;s++)h.push(r(t,o[s],i,n,a));return h}var s=t("../../core/VertexBuffer"),o=t("../../core/IndexBuffer"),h=t("../../core/WebGLContext"),u=t("../../render/Mesh"),d={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5126:"FLOAT"},f={0:"POINTS",1:"LINES",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN","default":"TRIANGLES"},c={34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER"},l={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5126:Float32Array},p={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};e.exports={createMeshes:function(t,e,i){var n,r=t.meshes,s={},o={};for(n in t.meshes)t.meshes.hasOwnProperty(n)&&(o[n]=a(s,r[n],t,e,i));return o}}}()},{"../../core/IndexBuffer":14,"../../core/VertexBuffer":20,"../../core/WebGLContext":23,"../../render/Mesh":31}],48:[function(t,e,i){!function(){"use strict";var t=["buffers","bufferViews","images","videos","samplers","textures","shaders","programs","techniques","materials","accessors","meshes","cameras","lights","skins","nodes","scenes","animations"],i=Object.create(Object.prototype,{_rootDescription:{value:null,writable:!0},rootDescription:{set:function(t){this._rootDescription=t},get:function(){return this._rootDescription}},baseURL:{value:null,writable:!0},_isAbsolutePath:{value:function(t){var e=new RegExp("^"+window.location.protocol,"i");return t.match(e)?!0:!1}},resolvePathIfNeeded:{value:function(t){return this._isAbsolutePath(t)?t:this.baseURL+t}},_resolvePathsForCategories:{value:function(t){t.forEach(function(t){var e=this.json[t];if(e){var i=Object.keys(e);i.forEach(function(t){var i=e[t];i.path=this.resolvePathIfNeeded(i.path||i.uri)},this)}},this)}},_json:{value:null,writable:!0},json:{enumerable:!0,get:function(){return this._json},set:function(t){this._json!==t&&(this._json=t,this._resolvePathsForCategories(["buffers","shaders","images","videos"]))}},_path:{value:null,writable:!0},getEntryDescription:{value:function(t,e){var i=null,n=e;return i=this.rootDescription[n],i?i?i[t]:null:(console.log("ERROR:CANNOT find expected category named:"+n),null)}},_stepToNextCategory:{value:function(){return this._state.categoryIndex=this.getNextCategoryIndex(this._state.categoryIndex+1),-1!==this._state.categoryIndex?(this._state.categoryState.index=0,!0):!1}},_stepToNextDescription:{enumerable:!1,value:function(){var t=this._state.categoryState,e=t.keys;return e?(t.index++,t.keys=null,t.index>=e.length?this._stepToNextCategory():!1):(console.log("INCONSISTENCY ERROR"),!1)}},hasCategory:{value:function(t){return this.rootDescription[t]?!0:!1}},_handleState:{value:function(){for(var e={buffers:this.handleBuffer,bufferViews:this.handleBufferView,shaders:this.handleShader,programs:this.handleProgram,techniques:this.handleTechnique,materials:this.handleMaterial,meshes:this.handleMesh,cameras:this.handleCamera,lights:this.handleLight,nodes:this.handleNode,scenes:this.handleScene,images:this.handleImage,animations:this.handleAnimation,accessors:this.handleAccessor,skins:this.handleSkin,samplers:this.handleSampler,textures:this.handleTexture,videos:this.handleVideo},i=!0;-1!==this._state.categoryIndex;){var n=t[this._state.categoryIndex],r=this._state.categoryState,a=r.keys;if(a||(r.keys=a=Object.keys(this.rootDescription[n]),!a||0!==a.length)){var s=n,o=a[r.index],h=this.getEntryDescription(o,s);if(h){if(e[s]&&e[s].call(this,o,h,this._state.userInfo)===!1){i=!1;break}this._stepToNextDescription()}else if(this.handleError){this.handleError("INCONSISTENCY ERROR: no description found for entry "+o),i=!1;break}}else this._stepToNextDescription()}this.handleLoadCompleted&&this.handleLoadCompleted(i)}},_loadJSONIfNeeded:{enumerable:!0,value:function(t){var e=this;if(this._json)t&&t(this.json);else{var i=this._path,n=i.lastIndexOf("/");this.baseURL=0!==n?i.substring(0,n+1):"";var r=new XMLHttpRequest;r.open("GET",i,!0),r.addEventListener("load",function(){e.json=JSON.parse(r.responseText),t&&t(e.json)},!1),r.send(null)}}},_buildLoader:{value:function(t){function e(e){i.rootDescription=e,t&&t(this)}var i=this;this._loadJSONIfNeeded(e)}},_state:{value:null,writable:!0},_getEntryType:{value:function(){for(var e=t,i=0;i<e.length;i++){var n=this.rootDescription[e[i]];if(n)return e[i]}return null}},getNextCategoryIndex:{value:function(e){for(var i=e;i<t.length;i++)if(this.hasCategory(t[i]))return i;return-1}},load:{enumerable:!0,value:function(t,e){var i=this;this._buildLoader(function(){var n=i.getNextCategoryIndex.call(i,0);-1!==n&&(i._state={userInfo:t,options:e,categoryIndex:n,categoryState:{index:"0"}},i._handleState())})}},initWithPath:{value:function(t){return this._path=t,this._json=null,this}},_knownURLs:{writable:!0,value:{}},loaderContext:{value:function(){return"undefined"==typeof this._knownURLs[this._path]&&(this._knownURLs[this._path]=Object.keys(this._knownURLs).length),"__"+this._knownURLs[this._path]}},initWithJSON:{value:function(t,e){return this.json=t,this.baseURL=e,e||console.log("WARNING: no base URL passed to Reader:initWithJSON"),this}}});e.exports=i}()},{}],49:[function(t,e,i){!function(){"use strict";function i(t,e,i){var n,r,a,s=t.accessors[e.inverseBindMatrices],o=t.bufferViews[s.bufferView],h=i[o.buffer],u=d[s.componentType],l=f[s.type],p=c[s.type],m=s.count*l,y=new u(h,o.byteOffset+s.byteOffset,m),g=[];for(a=0;a<s.count;a++)n=a*l,r=n+l,g.push(new p(y.subarray(n,r)));return g}function n(t,e,i,r,a){var s,u,d,f,c,l=t.nodes[e],p=r.jointNames.indexOf(l.jointName);if(-1===p)return null;for(s=o.getNodeMatrix(l),u=a[p],f=new h({id:e,name:l.jointName,bindMatrix:s,inverseBindMatrix:u,parent:i,children:[],index:p}),c=0;c<l.children.length;c++)d=n(t,l.children[c],f,r,a),d&&f.children.push(d);return f}var r=t("alfador"),a=r.Mat33,s=r.Mat44,o=t("./glTFUtil"),h=t("../../render/Joint"),u=t("../../render/Skeleton"),d={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5126:Float32Array},f={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},c={MAT3:a,MAT4:s};e.exports={createSkeleton:function(t,e,r){var a,o=e.skeletons,h=t.skins[e.skin],d=i(t,h,r),f=[];for(a=0;a<o.length;a++)f.push(n(t,o[a],null,h,d));return new u({root:f,bindShapeMatrix:new s(h.bindShapeMatrix||[])})}}}()},{"../../render/Joint":29,"../../render/Skeleton":37,"./glTFUtil":50,alfador:9}],50:[function(t,e,i){!function(){"use strict";var i=t("alfador"),n=i.Quaternion,r=i.Mat44,a=i.Vec2,s=i.Vec3,o=i.Vec4,h=t("../Util"),u=t("../XHRLoader");e.exports={convertVec4Array:function(t){var e,i=new Array(t.length/4);for(e=0;e<t.length;e+=4)i[e/4]=new o(t[e],t[e+1],t[e+2],t[e+3]);return i},convertVec3Array:function(t){var e,i=new Array(t.length/3);for(e=0;e<t.length;e+=3)i[e/3]=new s(t[e],t[e+1],t[e+2]);return i},convertVec2Array:function(t){var e,i=new Array(t.length/2);for(e=0;e<t.length;e+=2)i[e/2]=new a(t[e],t[e+1]);return i},getNodeMatrix:function(t){var e,i,a;return t.matrix?new r(t.matrix):(e=t.translation?r.translation(t.translation):r.identity(),i=t.rotation?r.rotationRadians(t.rotation[3],t.rotation):r.identity(),t.orientation&&(i=new n(t.orientation).matrix()),a=t.scale?r.scale(t.scale):r.identity(),e.mult(i).mult(a))},requestBuffers:function(t,e){function i(t){return function(e){u.load(t,{responseType:"arraybuffer",success:function(t){e(t)},error:function(t){console.error(t),e(null)}})}}var n,r={};for(n in t)t.hasOwnProperty(n)&&(r[n]=i(t[n].path));h.async(r,function(t){e(t)})},requestImages:function(t,e){function i(t){return function(e){var i=new Image;i.onload=function(){e(i)},i.src=t}}var n,r={};for(n in t)t.hasOwnProperty(n)&&(r[n]=i(t[n].path));h.async(r,function(t){e(t)})}}}()},{"../Util":41,"../XHRLoader":42,alfador:9}],51:[function(t,e,i){!function(){"use strict";function i(t){return function(e){var i=new Image;i.onload=function(){e(i)},i.src=t}}function n(t,e){return function(n){var r,a,s={id:t.name},h={};for(a in t)if(t.hasOwnProperty(a))switch(r=t[a],a){case"kd":s.diffuseColor=r;break;case"ka":s.ambientColor=r;break;case"ks":s.specularColor=r;break;
case"ns":s.specularComponent=r;break;case"map_kd":h.diffuse=i(e+"/"+r);break;case"d":1>r&&(s.alpha=r);break;case"illum":r>2&&10>r&&(s.reflection=.3),(6===r||7===r)&&(s.refraction=.8)}o.async(h,function(t){var e;for(e in t)t.hasOwnProperty(e)&&(s[e+"Texture"]=t[e]);n(s)})}}function r(t,e,i){var r,a={};for(r in t)t.hasOwnProperty(r)&&(a[r]=n(t[r],e));o.async(a,function(t){i(t)})}function a(t){var e,i,n,r,a,s,o=t.split("\n"),h={},u={};for(s=0;s<o.length;s++)i=o[s].trim(),0!==i.length&&"#"!==i.charAt(0)&&(n=i.indexOf(" "),n>=0?(r=i.substring(0,n).toLowerCase(),a=i.substring(n+1).trim()):(r=i,a=""),"newmtl"===r?(u={name:a},h[a]=u):u&&("ka"===r||"kd"===r||"ks"===r||"ke"===r?(e=a.split(/\s+/,3),u[r]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]):"ns"===r||"d"===r?u[r]=parseFloat(a):u[r]=a));return h}var s=t("path"),o=t("../Util"),h=t("../XHRLoader");e.exports={load:function(t,e){var i=s.dirname(t);h.load(t,{responseType:"text",success:function(t){var n=a(t);r(n,i,e)},error:function(t){console.error(t),e(null)}})}}}()},{"../Util":41,"../XHRLoader":42,path:10}],52:[function(t,e,i){!function(){"use strict";function i(t,e){var i=t.positions[e].toString();return t.normals&&(i+="-"+t.normals[e].toString()),t.uvs&&(i+="-"+t.uvs[e].toString()),i}function n(t){var e,n,r,a,s,o,h=[],u=[],d=[],f=[],c=0,l={};for(s=0;s<t.triangles.length;s++)for(r=t.triangles[s],o=0;3>o;o++)e=i(r,o),void 0===a?(h.push(r.positions[o]),r.normals&&u.push(r.normals[o]),r.uvs&&d.push(r.uvs[o]),f.push(c),l[e]=c,c++):f.push(a);return n={triangles:t.triangles,positions:h,indices:f,normals:u,material:t.material},d.length>0&&(n.uvs=d),n}function r(t){var e,i=t.meshes;for(e=0;e<i.length;e++)i[e]=n(i[e]);return t}function a(t){function e(t,e,i){var n;_=[],n={triangles:_},t&&(n.group=t),e&&(n.name=e),i&&(n.material=i),v.meshes.push(n),E=null,T=null}function i(t){var e=t.substring(7).trim();v.mtllib=v.mtllib||[],-1===v.mtllib.indexOf(e)&&v.mtllib.push(e)}function n(t){var e=parseInt(t,10);return e>=0?x[e-1]:x[e+x.length]}function r(t){var e=parseInt(t,10);return e>=0?w[e-1]:w[e+w.length]}function a(t){var e=parseInt(t,10);return e>=0?b[e-1]:b[e+b.length]}function s(t,e,i){var s,o,h,u,d,f,c,l={};l.positions=[n(t[0]),n(t[1]),n(t[2])],e&&(l.uvs=[r(e[0]),r(e[1]),r(e[2])]),i?l.normals=[a(i[0]),a(i[1]),a(i[2])]:(s=l.positions[0],o=l.positions[1],h=l.positions[2],u=[o[0]-s[0],o[1]-s[1],o[2]-s[2]],d=[h[0]-s[0],h[1]-s[1],h[2]-s[2]],f=[u[1]*d[2]-d[1]*u[2],-u[0]*d[2]+d[0]*u[2],u[0]*d[1]-d[0]*u[1]],c=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),f=[f[0]/c,f[1]/c,f[2]/c],l.normals=[f,f,f]),_.push(l)}function o(t,e,i){s(t,e,i),void 0!==t[3]&&(t=[t[0],t[2],t[3]],e&&(e=[e[0],e[2],e[3]]),i&&(i=[i[0],i[2],i[3]]),s(t,e,i))}var h,u,d,f=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,c=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,l=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,p=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/,m=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/,y=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/,g=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/,v={meshes:[]},x=[],w=[],b=[],_=[],E=null,T=null,M=t.split("\n");for(d=0;d<M.length;d++)h=M[d].trim(),0!==h.length&&"#"!==h.charAt(0)&&(null!==(u=f.exec(h))?x.push([parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])]):null!==(u=c.exec(h))?b.push([parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])]):null!==(u=l.exec(h))?w.push([parseFloat(u[1]),parseFloat(u[2])]):null!==(u=p.exec(h))?o([u[1],u[2],u[3],u[4]],null,null):null!==(u=m.exec(h))?o([u[2],u[5],u[8],u[11]],[u[3],u[6],u[9],u[12]],null):null!==(u=y.exec(h))?o([u[2],u[6],u[10],u[14]],[u[3],u[7],u[11],u[15]],[u[4],u[8],u[12],u[16]]):null!==(u=g.exec(h))?o([u[2],u[5],u[8],u[11]],null,[u[3],u[6],u[9],u[12]]):/^o /.test(h)?T=h.substring(2).trim():/^g /.test(h)?E=h.substring(2).trim():/^usemtl /.test(h)?e(E,T,h.substring(7).trim()):/^mtllib /.test(h)&&i(h));return 0===v.meshes.length&&v.meshes.push({triangles:_}),v}var s=t("../XHRLoader");e.exports={load:function(t,e){s.load(t,{responseType:"text",success:function(t){var i=a(t),n=r(i);e(n)},error:function(t){console.error(t),e(null)}})}}}()},{"../XHRLoader":42}],53:[function(t,e,i){!function(){"use strict";function i(t,e,i){var n=[];return t.mtllib?(t.mtllib.forEach(function(t){n.push(function(i){s.load(e+"/"+t,i)})}),void r.async(n,function(t){var e={};t.forEach(function(t){r.extend(e,t)}),i(e)})):void i(t)}var n=t("path"),r=t("../Util"),a=t("./OBJLoader"),s=t("./MTLLoader");e.exports={load:function(t,e){a.load(t,function(r){i(r,n.dirname(t),function(t){r.meshes.forEach(function(e){e.material=t[e.material]}),e(r)})})}}}()},{"../Util":41,"./MTLLoader":51,"./OBJLoader":52,path:10}],54:[function(t,e,i){!function(){"use strict";var t=1;e.exports={positions:function(e){return e=e||t,[[-e/2,-e/2,e/2],[e/2,-e/2,e/2],[e/2,e/2,e/2],[-e/2,e/2,e/2],[-e/2,-e/2,-e/2],[-e/2,e/2,-e/2],[e/2,e/2,-e/2],[e/2,-e/2,-e/2],[-e/2,e/2,-e/2],[-e/2,e/2,e/2],[e/2,e/2,e/2],[e/2,e/2,-e/2],[-e/2,-e/2,-e/2],[e/2,-e/2,-e/2],[e/2,-e/2,e/2],[-e/2,-e/2,e/2],[e/2,-e/2,-e/2],[e/2,e/2,-e/2],[e/2,e/2,e/2],[e/2,-e/2,e/2],[-e/2,-e/2,-e/2],[-e/2,-e/2,e/2],[-e/2,e/2,e/2],[-e/2,e/2,-e/2]]},normals:function(){return[[0,0,1],[0,0,1],[0,0,1],[0,0,1],[0,0,-1],[0,0,-1],[0,0,-1],[0,0,-1],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0],[1,0,0],[1,0,0],[1,0,0],[1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[-1,0,0]]},uvs:function(){return[[0,0],[1,0],[1,1],[0,1],[1,0],[1,1],[0,1],[0,0],[0,1],[0,0],[1,0],[1,1],[1,1],[0,1],[0,0],[1,0],[1,0],[1,1],[0,1],[0,0],[0,0],[1,0],[1,1],[0,1]]},indices:function(){return[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},geometry:function(t){return{positions:this.positions(t),normals:this.normals(),uvs:this.uvs(),indices:this.indices()}}}}()},{}],55:[function(t,e,i){!function(){"use strict";var t=20,i=1,n=1;e.exports={positions:function(e,r,a){var s,o,h,u,d=[];for(e=e||t,r=r||i,a=a||n,s=2*Math.PI/e,u=0;e>=u;u++)o=a*Math.sin(u*s),h=a*Math.cos(u*s),d.push([o,r,h]);for(u=0;e>=u;u++)o=a*Math.sin(u*s),h=a*Math.cos(u*s),d.push([o,0,h]);return d},normals:function(e){var i,n,r,a,s=[];for(e=e||t,i=2*Math.PI/e,a=0;e>=a;a++)n=Math.sin(a*i),r=Math.cos(a*i),s.push([n,0,r]);for(a=0;e>=a;a++)n=Math.sin(a*i),r=Math.cos(a*i),s.push([n,0,r]);return s},uvs:function(e){var i,n=[];for(e=e||t,i=0;e>=i;i++)n.push([i/e,1]);for(i=0;e>=i;i++)n.push([i/e,0]);return n},indices:function(e){var i,n=0,r=[];for(e=e||t,i=0;e>=i;i++)r.push(n+e+1),r.push(n),r.push(n+e),r.push(n+e+1),r.push(n+1),r.push(n),n++;return r},geometry:function(t,e){return{positions:this.positions(t,e),normals:this.normals(t),uvs:this.uvs(t),indices:this.indices(t)}}}}()},{}],56:[function(t,e,i){!function(){"use strict";var t=1;e.exports={positions:function(e){return e=e||t,[[-e/2,-e/2,0],[e/2,-e/2,0],[e/2,e/2,0],[-e/2,e/2,0]]},normals:function(){return[[0,0,1],[0,0,1],[0,0,1],[0,0,1]]},uvs:function(){return[[0,0],[1,0],[1,1],[0,1]]},indices:function(){return[0,1,2,0,2,3]},geometry:function(t){return{positions:this.positions(t),normals:this.normals(),uvs:this.uvs(),indices:this.indices()}}}}()},{}],57:[function(t,e,i){!function(){"use strict";function i(t,e,i){t=new a(t);var n=t.dot(e);return e=e.sub(t.mult(n)).normalize(),t.cross(e).dot(i)<0?e.negate():e}function n(t,e,i){t[e]?t[e].add(i):t[e]=new a(i)}var r=t("alfador"),a=r.Vec3,s=r.Vec2;e.exports={computeNormals:function(t,e){var i,n,r,s,o,h,u,d,f,c,l=new Array(t.length);for(c=0;c<e.length;c+=3)n=e[c],r=e[c+1],s=e[c+2],o=new a(t[n]),h=new a(t[r]),u=new a(t[s]),d=h.sub(o),f=u.sub(o),i=d.cross(f).normalize(),l[n]=i,l[r]=i,l[s]=i;return l},computeTangents:function(t,e,r,o){var h,u,d,f,c,l,p,m,y,g,v,x,w,b,_,E,T,M,A,z,R,S,U,C,I=new Array(t.length),L=new Array(t.length);for(C=0;C<o.length;C+=3)h=o[C],u=o[C+1],d=o[C+2],c=new a(t[h]),l=new a(t[u]),p=new a(t[d]),m=new s(r[h]),y=new s(r[u]),g=new s(r[d]),v=l.sub(c),x=p.sub(c),w=y.sub(m),b=g.sub(m),f=1/(w.x*b.y-w.y*b.x),_=v.mult(b.y),E=x.mult(w.y),A=_.sub(E).mult(f),T=x.mult(w.x),M=v.mult(b.x),U=T.sub(M).mult(f),z=i(e[h],A,U),R=i(e[u],A,U),S=i(e[d],A,U),n(I,h,z),n(I,u,R),n(I,d,S),n(L,h,U),n(L,u,U),n(L,d,U);for(C=0;C<I.length;C++)I[C]=I[C].normalize(),L[C]=L[C].normalize();return{tangents:I,bitangents:L}}}}()},{alfador:9}],58:[function(t,e,i){!function(){"use strict";var t=20,i=20,n=1;e.exports={positions:function(e,r,a){var s,o,h,u,d,f,c,l,p=[];for(e=e||t,r=r||i,a=a||n,s=Math.PI/r,o=2*Math.PI/e,c=0;r>=c;c++)for(h=a*Math.sin(c*s),u=a*Math.cos(c*s),l=0;e>=l;l++)d=h*Math.sin(l*o),f=h*Math.cos(l*o),p.push([d,u,f]);return p},normals:function(e,n){var r,a,s,o,h,u,d,f,c=[];for(e=e||t,n=n||i,r=Math.PI/n,a=2*Math.PI/e,d=0;n>=d;d++)for(s=Math.sin(d*r),o=Math.cos(d*r),f=0;e>=f;f++)h=s*Math.sin(f*a),u=s*Math.cos(f*a),c.push([h,o,u]);return c},uvs:function(e,n){var r,a,s=[];for(e=e||t,n=n||i,r=0;n>=r;r++)for(a=0;e>=a;a++)s.push([a/e,1-r/n]);return s},indices:function(e,n){var r,a,s=0,o=[];for(e=e||t,n=n||i,r=0;n>=r;r++)for(a=0;e>=a;a++)r!==n&&(o.push(s+e+1),o.push(s),o.push(s+e),o.push(s+e+1),o.push(s+1),o.push(s),s++);return o},geometry:function(t,e,i){return{positions:this.positions(t,e,i),normals:this.normals(t,e),uvs:this.uvs(t,e),indices:this.indices(t,e)}}}}()},{}]},{},[24])(24)});